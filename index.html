<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - إدارة الحياة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK v9 Compat (More Stable) -->
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/compat/firebase-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/compat/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.23.0/compat/firebase-firestore.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Login Screen Styles */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .login-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .login-box {
            background: white;
            padding: 50px 40px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 420px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--text-gray);
            margin-bottom: 35px;
            font-size: 15px;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 3px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            color: #ef4444;
            font-size: 14px;
            margin-top: 15px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .login-error.show {
            opacity: 1;
        }

        .login-hint {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-gray);
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-dark);
            border: 2px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .logout-btn:hover {
            background: white;
            border-color: #ef4444;
            color: #ef4444;
        }

        :root {
            --primary-purple: #6366f1;
            --primary-green: #10b981;
            --primary-orange: #f97316;
            --primary-pink: #ec4899;
            --primary-cyan: #06b6d4;
            --primary-yellow: #fbbf24;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
        }

        .btn-primary {
            background: var(--primary-purple);
            color: white;
        }

        .btn-primary:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-purple);
            color: var(--primary-purple);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 28px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-pink));
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }

        .card-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .icon-green { background: #d1fae5; color: var(--primary-green); }
        .icon-purple { background: #e0e7ff; color: var(--primary-purple); }
        .icon-pink { background: #fce7f3; color: var(--primary-pink); }
        .icon-yellow { background: #fef3c7; color: var(--primary-yellow); }
        .icon-cyan { background: #cffafe; color: var(--primary-cyan); }
        .icon-orange { background: #fed7aa; color: var(--primary-orange); }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .metric-value {
            font-size: 56px;
            font-weight: 800;
            text-align: center;
            margin: 25px 0;
        }

        .metric-label {
            text-align: center;
            color: var(--text-gray);
            font-size: 15px;
            margin-top: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-pink));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .wheel-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .wheel-card {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .life-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .life-area-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 15px;
        }

        .life-area-bar {
            flex: 1;
            margin: 0 20px;
            height: 8px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .life-area-progress {
            height: 100%;
            background: var(--primary-purple);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .life-area-value {
            font-weight: 700;
            color: var(--text-dark);
            min-width: 45px;
            text-align: left;
        }

        .projects-section {
            grid-column: 1 / -1;
        }

        .project-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-right: 4px solid var(--primary-purple);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .project-title {
            font-weight: 700;
            font-size: 17px;
            color: var(--text-dark);
        }

        .project-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-planning { background: #f3e8ff; color: #7c3aed; }

        .project-desc {
            color: var(--text-gray);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .project-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-tag {
            background: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-gray);
        }

        .circular-progress {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto;
        }

        .routine-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-light);
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .routine-item:hover {
            background: #e0e7ff;
        }

        .routine-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid var(--primary-green);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .routine-checkbox.checked {
            background: var(--primary-green);
            position: relative;
        }

        .routine-checkbox.checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .routine-text {
            flex: 1;
        }

        .routine-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .routine-time {
            font-size: 13px;
            color: var(--text-gray);
        }

        .quote-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 15px;
            font-style: italic;
            line-height: 1.8;
        }

        .quote-author {
            text-align: left;
            margin-top: 10px;
            font-weight: 600;
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--text-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .form-actions .btn {
            flex: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.5s ease forwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .wheel-section {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .header-actions {
                width: 100%;
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .edit-btn {
            background: var(--primary-purple);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #4f46e5;
            transform: scale(1.05);
        }

        /* Health Details Modal Styles */
        .health-modal {
            max-width: 900px;
            width: 95%;
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .health-metric-card {
            background: var(--bg-light);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid var(--primary-blue);
        }

        .health-metric-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .health-metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .icon-blue { background: #dbeafe; color: #2563eb; }

        .health-metric-info h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .health-metric-info p {
            font-size: 13px;
            color: var(--text-gray);
        }

        .health-value-display {
            text-align: center;
            margin: 20px 0;
        }

        .health-value-number {
            font-size: 42px;
            font-weight: 800;
            color: var(--primary-blue);
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 8px;
        }

        .health-value-unit {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-gray);
        }

        .health-slider-container {
            margin: 20px 0;
        }

        .health-slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-gray);
        }

        .health-slider {
            width: 100%;
            height: 8px;
            border-radius: 10px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .health-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        .health-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: none;
        }

        .health-progress-bar-container {
            margin-top: 15px;
        }

        .health-progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .health-progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease, background 0.3s ease;
        }

        .health-progress-text {
            text-align: center;
            font-size: 14px;
            font-weight: 700;
        }

        .progress-excellent { background: var(--primary-green); color: var(--primary-green); }
        .progress-good { background: var(--primary-purple); color: var(--primary-purple); }
        .progress-warning { background: var(--primary-orange); color: var(--primary-orange); }

        .health-summary-card {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            padding: 30px;
            border-radius: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .health-summary-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .health-summary-subtitle {
            font-size: 14px;
            color: var(--text-gray);
            margin-bottom: 20px;
        }

        .health-summary-score {
            font-size: 72px;
            font-weight: 900;
            color: var(--primary-green);
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .health-summary-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-gray);
        }

        .clickable-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clickable-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        :root {
            --primary-blue: #2563eb;
        }

        /* Goals Management Modal Styles */
        .goals-modal {
            max-width: 1100px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .goals-section {
            margin-bottom: 40px;
        }

        .goals-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--border-color);
        }

        .goals-section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            color: var(--text-dark);
        }

        .goals-section-icon {
            font-size: 32px;
        }

        .add-goal-btn {
            padding: 10px 20px;
            background: var(--primary-purple);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .add-goal-btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .goal-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .goal-card:hover {
            border-color: var(--primary-purple);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
            transform: translateY(-3px);
        }

        .goal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .goal-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            flex: 1;
        }

        .goal-actions {
            display: flex;
            gap: 8px;
        }

        .goal-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .goal-actions {
            display: flex;
            gap: 8px;
            position: relative;
            z-index: 10;
        }

        .goal-edit-btn {
            background: #e0e7ff;
            color: var(--primary-purple);
        }

        .goal-edit-btn:hover {
            background: var(--primary-purple);
            color: white;
            transform: scale(1.1);
        }

        .goal-delete-btn {
            background: #fee2e2;
            color: #dc2626;
        }

        .goal-delete-btn:hover {
            background: #dc2626;
            color: white;
            transform: scale(1.1);
        }

        .goal-description {
            font-size: 14px;
            color: var(--text-gray);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .goal-linked-sector {
            display: inline-block;
            background: var(--bg-light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 15px;
        }

        .goal-values {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .goal-current {
            font-weight: 700;
            color: var(--primary-purple);
        }

        .goal-target {
            color: var(--text-gray);
        }

        .goal-progress-container {
            margin-bottom: 12px;
        }

        .goal-progress-bar {
            width: 100%;
            height: 12px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .goal-progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .goal-progress-fill.excellent {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .goal-progress-fill.good {
            background: linear-gradient(90deg, #6366f1, #4f46e5);
        }

        .goal-progress-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .goal-progress-fill.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .goal-progress-fill.extra-mile {
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .goal-progress-text {
            text-align: center;
            font-size: 15px;
            font-weight: 700;
            margin-top: 8px;
        }

        .goal-progress-text.excellent { color: #10b981; }
        .goal-progress-text.good { color: #6366f1; }
        .goal-progress-text.warning { color: #f59e0b; }
        .goal-progress-text.danger { color: #ef4444; }
        .goal-progress-text.extra-mile { color: #8b5cf6; }

        .goal-extra-mile-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 3px 10px rgba(139, 92, 246, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .empty-goals-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .empty-goals-icon {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-goals-text {
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* Satisfaction Management Styles */
        .satisfaction-modal {
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .satisfaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .satisfaction-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            min-width: 200px;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .view-toggle-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary-purple);
            background: white;
            color: var(--primary-purple);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: var(--primary-purple);
            color: white;
        }

        .satisfaction-score-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .satisfaction-score-value {
            font-size: 72px;
            font-weight: 900;
            color: var(--primary-orange);
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .satisfaction-score-label {
            font-size: 16px;
            color: var(--text-gray);
            margin-bottom: 15px;
        }

        .satisfaction-score-breakdown {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }

        .score-breakdown-item {
            font-size: 14px;
            font-weight: 600;
        }

        .score-core { color: #10b981; }
        .score-bonus { color: #8b5cf6; }

        .section-container {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .section-container:hover {
            border-color: var(--primary-purple);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-light);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .section-actions {
            display: flex;
            gap: 8px;
        }

        .section-action-btn {
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .add-task-btn {
            background: #e0e7ff;
            color: var(--primary-purple);
        }

        .add-task-btn:hover {
            background: var(--primary-purple);
            color: white;
        }

        .edit-section-btn {
            background: #dbeafe;
            color: #2563eb;
        }

        .edit-section-btn:hover {
            background: #2563eb;
            color: white;
        }

        .delete-section-btn {
            background: #fee2e2;
            color: #dc2626;
        }

        .delete-section-btn:hover {
            background: #dc2626;
            color: white;
        }

        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-light);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .task-item:hover {
            background: #e0e7ff;
            transform: translateX(-5px);
        }

        .task-item.completed {
            opacity: 0.7;
        }

        .task-checkbox {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 3px solid var(--primary-purple);
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            position: relative;
        }

        .task-checkbox.checked {
            background: var(--primary-purple);
        }

        .task-checkbox.checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 18px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .task-badge.core {
            background: #d1fae5;
            color: #059669;
        }

        .task-badge.bonus {
            background: #ede9fe;
            color: #7c3aed;
        }

        .task-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .task-action-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .task-edit-icon {
            background: #dbeafe;
            color: #2563eb;
        }

        .task-edit-icon:hover {
            background: #2563eb;
            color: white;
        }

        .task-delete-icon {
            background: #fee2e2;
            color: #dc2626;
        }

        .task-delete-icon:hover {
            background: #dc2626;
            color: white;
        }

        .weekly-view-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 25px;
        }

        .weekly-chart-container {
            height: 300px;
            margin-top: 20px;
        }

        .weekly-average {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 20px;
        }

        .add-section-fab {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-purple), #7c3aed);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .add-section-fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.6);
        }

        /* Weekly Tracker Styles */
        .weekly-tracker-modal {
            max-width: 1400px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .weekly-score-header {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .weekly-score-value {
            font-size: 72px;
            font-weight: 900;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .weekly-score-label {
            font-size: 18px;
            opacity: 0.95;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .day-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            border-color: var(--primary-yellow);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.2);
        }

        .day-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--bg-light);
        }

        .day-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .day-score {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-yellow);
        }

        .day-tasks-list {
            margin-bottom: 15px;
        }

        .day-task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .day-task-item:hover {
            background: #fef3c7;
        }

        .day-task-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 3px solid var(--primary-yellow);
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
        }

        .day-task-checkbox.checked {
            background: var(--primary-yellow);
        }

        .day-task-checkbox.checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 16px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .day-task-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .day-task-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
        }

        .day-task-item.completed .day-task-title {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .day-task-controls {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .day-task-item:hover .day-task-controls {
            opacity: 1;
        }

        .day-task-control-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .task-up-btn { background: #dbeafe; color: #2563eb; }
        .task-down-btn { background: #dbeafe; color: #2563eb; }
        .task-up-btn:hover, .task-down-btn:hover { background: #2563eb; color: white; }

        .day-progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .day-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-yellow), var(--primary-orange));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .day-add-task-btn {
            width: 100%;
            padding: 10px;
            background: var(--bg-light);
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .day-add-task-btn:hover {
            background: #fef3c7;
            border-color: var(--primary-yellow);
            color: var(--primary-yellow);
        }

        .template-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .template-btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-weekday-btn {
            background: #dbeafe;
            color: #2563eb;
        }

        .template-weekend-btn {
            background: #fef3c7;
            color: #f59e0b;
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Projects Search and Filter Styles */
        .projects-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .projects-search-bar {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .projects-search-bar:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .projects-search-bar::placeholder {
            color: var(--text-gray);
        }

        .filter-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .filter-chips-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
            margin-left: 10px;
        }

        .filter-chip {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            background: white;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .filter-chip:hover {
            border-color: var(--primary-purple);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: var(--primary-purple);
            border-color: var(--primary-purple);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .filter-chip.active:hover {
            background: #4f46e5;
            border-color: #4f46e5;
        }

        .projects-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .projects-empty-icon {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .projects-empty-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .projects-empty-text {
            font-size: 15px;
            margin-bottom: 20px;
        }

        .clear-filters-btn {
            padding: 10px 20px;
            background: var(--primary-purple);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-filters-btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
        }

        /* Enhanced Range Slider Styles */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 10px;
            background: linear-gradient(to right, #e2e8f0 0%, #e2e8f0 100%);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.5);
        }

        input[type="range"]::-webkit-slider-runnable-track {
            height: 8px;
            border-radius: 10px;
        }

        input[type="range"]::-moz-range-track {
            height: 8px;
            border-radius: 10px;
            background: #e2e8f0;
        }

        /* Wheel Modal Responsive Grid */
        @media (max-width: 768px) {
            .modal-content > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }

        /* Strategic Focus Modal Styles */
        .focus-item-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .focus-item-card:hover {
            background: #f1f5f9;
            transform: translateX(-3px);
        }

        .focus-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .focus-item-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-dark);
        }

        .focus-item-icon {
            font-size: 20px;
        }

        .focus-item-actions {
            display: flex;
            gap: 8px;
        }

        .focus-item-slider-container {
            margin-bottom: 10px;
        }

        .focus-item-value-display {
            text-align: center;
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .focus-item-progress {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .focus-item-progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Knowledge Vault Tabs Styles */
        .knowledge-tabs-wrapper {
            overflow-x: auto;
            overflow-y: hidden;
            margin: 0 -20px 20px -20px;
            padding: 0 20px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .knowledge-tabs-wrapper::-webkit-scrollbar {
            display: none;
        }

        .knowledge-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0;
            min-width: min-content;
        }

        .knowledge-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .knowledge-tab:hover {
            color: var(--primary-purple);
            background: rgba(99, 102, 241, 0.05);
        }

        .knowledge-tab.active {
            color: var(--primary-purple);
            border-bottom-color: var(--primary-purple);
        }

        .knowledge-content {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 5px;
        }

        .knowledge-content::-webkit-scrollbar {
            width: 6px;
        }

        .knowledge-content::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 10px;
        }

        .knowledge-content::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 10px;
        }

        .knowledge-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-gray);
        }

        .knowledge-tab-content {
            display: none;
        }

        .knowledge-tab-content.active {
            display: block;
        }

        /* Quote Card Styles */
        .quote-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .quote-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .quote-card::before {
            content: '"';
            position: absolute;
            top: -10px;
            right: 10px;
            font-size: 80px;
            opacity: 0.2;
            font-family: Georgia, serif;
        }

        .quote-text {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            font-style: italic;
        }

        .quote-author {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
            text-align: left;
            position: relative;
            z-index: 1;
        }

        .quote-actions {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quote-card:hover .quote-actions {
            opacity: 1;
        }

        .quote-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quote-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Book Card Styles */
        .books-progress-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .books-progress-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .books-progress-value {
            font-size: 48px;
            font-weight: 900;
            margin: 10px 0;
        }

        .books-progress-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .books-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .books-progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .book-item {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .book-item:hover {
            background: #f1f5f9;
            transform: translateX(-3px);
        }

        .book-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .book-author {
            font-size: 14px;
            color: var(--text-gray);
            margin-bottom: 5px;
        }

        .book-status {
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .book-status.completed {
            background: #d1fae5;
            color: #059669;
        }

        .book-status.reading {
            background: #dbeafe;
            color: #2563eb;
        }

        /* Note Card Styles */
        .note-card {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-right: 4px solid var(--primary-purple);
            transition: all 0.3s ease;
        }

        .note-card:hover {
            background: #f1f5f9;
            transform: translateX(-3px);
        }

        .note-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .note-content {
            color: var(--text-gray);
            line-height: 1.6;
            font-size: 14px;
        }

        .note-date {
            font-size: 12px;
            color: var(--text-gray);
            opacity: 0.7;
            margin-top: 10px;
        }

        .empty-knowledge-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-gray);
        }

        .empty-knowledge-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* ========================================
           WHEEL OF LIFE - DONUT CHART DESIGN
           ======================================== */
        
        .wheel-section {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 40px;
        }

        .wheel-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
        }

        .wheel-main-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
        }

        .edit-btn-modern {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .edit-btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        /* Two Column Layout */
        .wheel-donut-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 60px;
            align-items: center;
        }

        /* LEFT: Donut Chart */
        .donut-chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .donut-wrapper {
            position: relative;
            width: 350px;
            height: 350px;
        }

        #wheelChart {
            width: 100% !important;
            height: 100% !important;
        }

        .donut-center-score {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
        }

        .donut-score-value {
            font-size: 56px;
            font-weight: 900;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            font-family: 'Cairo', sans-serif;
        }

        .donut-score-label {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 8px;
            font-weight: 600;
        }

        /* RIGHT: Progress Bars List */
        .dimensions-progress-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .progress-list-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0 0 20px 0;
        }

        .dimension-progress-row {
            display: grid;
            grid-template-columns: 140px 1fr 60px;
            align-items: center;
            gap: 20px;
            padding: 14px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .dimension-progress-row:last-child {
            border-bottom: none;
        }

        .dimension-row-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dimension-row-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .dimension-row-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .dimension-row-bar-container {
            position: relative;
            height: 10px;
            background: #f1f5f9;
            border-radius: 10px;
            overflow: hidden;
        }

        .dimension-row-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .dimension-row-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
            text-align: right;
        }

        /* Hide old wheel elements */
        .wheel-optimized-grid,
        .wheel-visualizer-primary,
        .wheel-canvas-wrapper,
        .hero-score-center,
        .wheel-color-legend,
        .wheel-assessments-compact,
        .assessments-title-bar,
        .assessments-stack,
        .dimension-card-compact,
        .growth-alert-compact {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .wheel-donut-layout {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .donut-wrapper {
                width: 300px;
                height: 300px;
            }
            
            .donut-score-value {
                font-size: 48px;
            }
        }

        @media (max-width: 768px) {
            .wheel-section {
                padding: 25px;
            }
            
            .wheel-section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .donut-wrapper {
                width: 280px;
                height: 280px;
            }
            
            .dimension-progress-row {
                grid-template-columns: 100px 1fr 50px;
                gap: 12px;
            }
        }

        /* Grid Layout - BALANCED 50/50 */
        .wheel-optimized-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: start;
        }

        /* ========================================
           LEFT SIDE: WHEEL VISUALIZER
           ======================================== */
        
        .wheel-visualizer-primary {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-canvas-wrapper {
            position: relative;
            width: 100%;
            max-width: 550px;
            height: 550px;
            margin-bottom: 30px;
        }

        .hero-score-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
        }

        .hero-score-badge {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }

        .hero-label {
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 3px;
            color: var(--text-gray);
            margin-bottom: 8px;
        }

        .hero-number {
            font-size: 84px;
            font-weight: 900;
            line-height: 1;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Cairo', sans-serif;
        }

        .hero-subtitle {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 8px;
            font-weight: 600;
        }

        #wheelChart {
            width: 100% !important;
            height: 100% !important;
        }

        /* Color Legend Below Wheel */
        .wheel-color-legend {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px 20px;
            max-width: 550px;
            width: 100%;
        }

        .legend-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .legend-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* ========================================
           RIGHT SIDE: ASSESSMENT CARDS
           ======================================== */
        
        .wheel-assessments-compact {
            display: flex;
            flex-direction: column;
        }

        .assessments-title-bar {
            margin-bottom: 25px;
        }

        .assessments-title-bar h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0 0 5px 0;
        }

        .assessments-title-bar p {
            font-size: 13px;
            color: var(--text-gray);
            margin: 0;
        }

        .assessments-stack {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Individual Assessment Card */
        .dimension-card-compact {
            background: white;
            padding: 18px 20px;
            border-radius: 14px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .dimension-card-compact:hover {
            border-color: var(--primary-purple);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.12);
            transform: translateX(-3px);
        }

        .dimension-card-compact.low-alert {
            background: linear-gradient(135deg, #fffbeb 0%, white 100%);
            border-color: #fbbf24;
            animation: gentle-glow 3s ease-in-out infinite;
        }

        @keyframes gentle-glow {
            0%, 100% { box-shadow: 0 0 0 rgba(251, 191, 36, 0); }
            50% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.2); }
        }

        .dimension-card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .dimension-label-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dimension-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .dimension-name-text {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .dimension-value-bold {
            font-size: 22px;
            font-weight: 900;
        }

        .dimension-slider-area {
            margin-top: 10px;
        }

        .dimension-progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .dimension-progress-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Growth Alert */
        .growth-alert-compact {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #fbbf24;
            margin-top: 15px;
            display: flex;
            gap: 12px;
            align-items: start;
        }

        .growth-icon-mini {
            font-size: 24px;
        }

        .growth-text-mini strong {
            display: block;
            font-size: 14px;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .growth-text-mini p {
            font-size: 12px;
            color: var(--text-gray);
            margin: 0;
            line-height: 1.4;
        }

        /* ========================================
           RESPONSIVE DESIGN
           ======================================== */
        
        @media (max-width: 1200px) {
            .wheel-optimized-grid {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .wheel-visualizer-primary {
                order: 1;
            }
            
            .wheel-assessments-compact {
                order: 2;
            }
            
            .wheel-canvas-wrapper {
                height: 500px;
            }
            
            .hero-number {
                font-size: 72px;
            }
        }

        @media (max-width: 768px) {
            .wheel-section {
                padding: 25px;
            }
            
            .wheel-section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .wheel-main-title {
                font-size: 22px;
            }
            
            .wheel-canvas-wrapper {
                height: 400px;
            }
            
            .hero-number {
                font-size: 56px;
            }
            
            .wheel-color-legend {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .assessments-title-bar h3 {
                font-size: 18px;
            }
        }

        /* Remove old styles */
        .wheel-two-column-layout,
        .wheel-assessments-column,
        .wheel-visualizer-column,
        .dimension-assessment-card {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-icon">🔐</div>
            <h1 class="login-title">مرحباً بك</h1>
            <p class="login-subtitle">أدخل رمز الدخول للوصول إلى لوحة التحكم</p>
            <input 
                type="password" 
                id="passwordInput" 
                class="login-input" 
                placeholder="• • • • • •"
                maxlength="6"
                autocomplete="off"
            >
            <button class="login-btn" onclick="checkPassword()">🚀 دخول</button>
            <div class="login-error" id="loginError">❌ الرمز غير صحيح، حاول مرة أخرى</div>
            <div class="login-hint">
                💡 الرمز الافتراضي: <strong>12saud</strong><br>
                <span style="font-size: 12px; opacity: 0.7;">يمكنك تغييره من الكود</span>
            </div>
        </div>
    </div>

    <!-- Logout Button -->
    <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">
        🚪 تسجيل الخروج
    </button>

    <div class="container" id="mainContent" style="display: none;">
        <!-- Header -->
        <div class="header">
            <h1>
                <span>📊</span>
                لوحة التحكم الشخصية
            </h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openEditModal()">✏️ تعديل البيانات</button>
                <button class="btn btn-secondary" onclick="exportData()">📥 تصدير البيانات</button>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Health Index Card -->
            <div class="card clickable-card" onclick="openHealthModal()">
                <div class="card-header">
                    <div class="card-icon icon-green">💚</div>
                    <div class="card-title">مؤشر الصحة</div>
                </div>
                <div class="circular-progress">
                    <canvas id="healthChart"></canvas>
                </div>
                <div class="metric-value" style="color: var(--primary-green);" id="healthValue">78%</div>
                <div class="metric-label">انقر لعرض التفاصيل</div>
            </div>

            <!-- Goals Index Card -->
            <div class="card clickable-card" onclick="openGoalsModal()">
                <div class="card-header">
                    <div class="card-icon icon-purple">🎯</div>
                    <div class="card-title">مؤشر الأهداف</div>
                </div>
                <div class="circular-progress">
                    <canvas id="goalsChart"></canvas>
                </div>
                <div class="metric-value" style="color: var(--primary-purple);" id="goalsValue">44%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="goalsFill" style="width: 44%"></div>
                </div>
                <div class="metric-label">الإرث ومعالم 2026</div>
            </div>

            <!-- Satisfaction Card -->
            <div class="card clickable-card" onclick="openSatisfactionModal()">
                <div class="card-header">
                    <div class="card-icon icon-pink">❤️</div>
                    <div class="card-title">الرضا والإنجاز</div>
                </div>
                <div class="metric-value" style="color: var(--primary-orange);" id="satisfactionValue">40</div>
                <div class="metric-label" style="font-weight: 600; color: var(--text-dark);">استمر في التقدم</div>
                <div class="metric-label" style="margin-top: 15px;">المهام الأساسية: 100% • المكافأة: أعلى من 100%</div>
            </div>

            <!-- Week Tracker Card -->
            <div class="card clickable-card" onclick="openWeeklyTrackerModal()">
                <div class="card-header">
                    <div class="card-icon icon-yellow">📅</div>
                    <div class="card-title">متتبع الأسبوع المثالي</div>
                </div>
                <div class="metric-value" style="color: var(--primary-yellow);" id="weekValue">79%</div>
                <div class="metric-label">المتوسط الأسبوعي</div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px; font-size: 13px; color: var(--text-gray);">
                    <span>إثنين</span>
                    <span>ثلاثاء</span>
                    <span>أربعاء</span>
                    <span>خميس</span>
                    <span>جمعة</span>
                    <span>سبت</span>
                    <span>أحد</span>
                </div>
            </div>
        </div>

        <!-- Wheel of Life Section -->
        <div class="wheel-section">
            <div class="wheel-section-header">
                <h2 class="wheel-main-title">عجلة الحياة التفاعلية</h2>
                <button class="edit-btn-modern" onclick="openWheelModal()">
                    <span>✏️</span> تعديل
                </button>
            </div>
            
            <div class="wheel-donut-layout">
                <!-- Left: Donut Chart -->
                <div class="donut-chart-container">
                    <div class="donut-wrapper">
                        <canvas id="wheelChart"></canvas>
                        <div class="donut-center-score">
                            <div class="donut-score-value" id="heroLifeBalance">67%</div>
                            <div class="donut-score-label">Life Balance Score</div>
                        </div>
                    </div>
                </div>
                
                <!-- Right: Progress Bars -->
                <div class="dimensions-progress-list">
                    <h3 class="progress-list-title">الأبعاد التفصيلية</h3>
                    <div id="dimensionAssessments"></div>
                </div>
            </div>
        </div>

        <!-- Active Projects Section -->
        <div class="dashboard-grid projects-section">
            <div class="card" style="grid-column: 1 / -1;">
                <div class="section-title">
                    🎯 المشاريع النشطة
                    <button class="edit-btn" onclick="openProjectModal()">➕ إضافة مشروع</button>
                </div>
                
                <!-- Search and Filter Controls -->
                <div class="projects-controls">
                    <input 
                        type="text" 
                        class="projects-search-bar" 
                        id="projectsSearchBar"
                        placeholder="🔍 ابحث في المشاريع..."
                    >
                    
                    <div class="filter-chips-container">
                        <span class="filter-chips-label">الفئات:</span>
                        <div class="filter-chip" data-category="all" onclick="toggleProjectFilter('all')">
                            الكل
                        </div>
                        <div class="filter-chip" data-category="OGAbdullah" onclick="toggleProjectFilter('OGAbdullah')">
                            OGAbdullah
                        </div>
                        <div class="filter-chip" data-category="Side Income" onclick="toggleProjectFilter('Side Income')">
                            Side Income
                        </div>
                        <div class="filter-chip" data-category="Personal" onclick="toggleProjectFilter('Personal')">
                            Personal
                        </div>
                        <div class="filter-chip" data-category="Career" onclick="toggleProjectFilter('Career')">
                            Career
                        </div>
                    </div>
                </div>
                
                <div id="projectsList">
                    <!-- Projects will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="dashboard-grid">
            <!-- Strategic Focus -->
            <div class="card clickable-card" onclick="openStrategicFocusModal()">
                <div class="card-header">
                    <div class="card-icon icon-cyan">🎯</div>
                    <div class="card-title">التركيز الاستراتيجي</div>
                </div>
                <div id="strategicFocus"></div>
                <div class="metric-label" style="margin-top: 20px;">أربع ركائز للنمو الاستراتيجي</div>
            </div>

            <!-- Routine & Flex -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-orange">🔄</div>
                    <div class="card-title">الروتين والمرونة</div>
                </div>
                <div id="routineList"></div>
                <div class="metric-label" style="margin-top: 15px;">منع الإرهاق بالمرونة</div>
            </div>

            <!-- Knowledge Vault -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-purple">📚</div>
                    <div class="card-title">خزينة المعرفة</div>
                    <button class="edit-btn" onclick="openAddKnowledgeModal()" style="margin-right: auto;">
                        ➕ إضافة
                    </button>
                </div>
                
                <!-- Tabs Navigation -->
                <div class="knowledge-tabs-wrapper">
                    <div class="knowledge-tabs">
                        <button class="knowledge-tab active" data-tab="quotes" onclick="switchKnowledgeTab('quotes')">
                            💬 Quotes
                        </button>
                        <button class="knowledge-tab" data-tab="books" onclick="switchKnowledgeTab('books')">
                            📖 Books
                        </button>
                        <button class="knowledge-tab" data-tab="notes" onclick="switchKnowledgeTab('notes')">
                            📝 Notes
                        </button>
                    </div>
                </div>
                
                <!-- Content Area -->
                <div class="knowledge-content">
                    <!-- Quotes Tab -->
                    <div class="knowledge-tab-content active" id="quotesContent"></div>
                    
                    <!-- Books Tab -->
                    <div class="knowledge-tab-content" id="booksContent"></div>
                    
                    <!-- Notes Tab -->
                    <div class="knowledge-tab-content" id="notesContent"></div>
                </div>
            </div>

            <!-- Career UX -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-green">📈</div>
                    <div class="card-title">تجربة المهنة</div>
                </div>
                <div id="careerMetrics"></div>
                <div class="metric-label" style="margin-top: 15px;">تحسين سير العمل الاستراتيجي</div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">✏️ تعديل المؤشرات الرئيسية</div>
            <form id="editForm">
                <div class="form-group">
                    <label class="form-label">مؤشر الصحة (%)</label>
                    <input type="number" class="form-input" id="healthInput" min="0" max="100" value="78">
                </div>
                <div class="form-group">
                    <label class="form-label">مؤشر الأهداف (%)</label>
                    <input type="number" class="form-input" id="goalsInput" min="0" max="100" value="44">
                </div>
                <div class="form-group">
                    <label class="form-label">نقاط الرضا</label>
                    <input type="number" class="form-input" id="satisfactionInput" min="0" value="40">
                </div>
                <div class="form-group">
                    <label class="form-label">متتبع الأسبوع (%)</label>
                    <input type="number" class="form-input" id="weekInput" min="0" max="100" value="79">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Wheel Edit Modal -->
    <div class="modal" id="wheelModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">✏️ تعديل عجلة الحياة</div>
            
            <!-- Life Balance Score Display -->
            <div style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; color: white;">
                <div style="font-size: 16px; margin-bottom: 10px; opacity: 0.9;">Life Balance Score</div>
                <div style="font-size: 48px; font-weight: 900;" id="lifeBalanceScoreDisplay">73%</div>
                <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">متوسط الأبعاد السبعة</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Left Side: Inputs with Real-time Sliders -->
                <div>
                    <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 20px; color: var(--text-dark);">
                        أدخل التقييمات (0-100)
                    </h3>
                    <form id="wheelForm">
                        <div class="form-group">
                            <label class="form-label">
                                المهني: <span id="careerDisplay" style="color: #6366f1; font-weight: 700;">75%</span>
                            </label>
                            <input type="range" class="form-input" id="careerInput" min="0" max="100" value="75" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                المالي: <span id="financeDisplay" style="color: #10b981; font-weight: 700;">65%</span>
                            </label>
                            <input type="range" class="form-input" id="financeInput" min="0" max="100" value="65" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                الصحي: <span id="healthWheelDisplay" style="color: #f97316; font-weight: 700;">80%</span>
                            </label>
                            <input type="range" class="form-input" id="healthWheelInput" min="0" max="100" value="80" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                الإيماني: <span id="spiritualityDisplay" style="color: #8b5cf6; font-weight: 700;">85%</span>
                            </label>
                            <input type="range" class="form-input" id="spiritualityInput" min="0" max="100" value="85" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                اجتماعي: <span id="socialDisplay" style="color: #3b82f6; font-weight: 700;">70%</span>
                            </label>
                            <input type="range" class="form-input" id="socialInput" min="0" max="100" value="70" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                الثقافي: <span id="culturalDisplay" style="color: #ec4899; font-weight: 700;">78%</span>
                            </label>
                            <input type="range" class="form-input" id="culturalInput" min="0" max="100" value="78" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                الترفيهي: <span id="recreationDisplay" style="color: #fbbf24; font-weight: 700;">60%</span>
                            </label>
                            <input type="range" class="form-input" id="recreationInput" min="0" max="100" value="60" 
                                   oninput="updateWheelPreview()" style="width: 100%;">
                        </div>
                    </form>
                </div>

                <!-- Right Side: Live Preview with Sidebar Legend -->
                <div>
                    <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 20px; color: var(--text-dark); text-align: center;">
                        المعاينة المباشرة
                    </h3>
                    <canvas id="wheelPreviewChart" style="max-width: 350px; width: 100%; margin: 0 auto; display: block;"></canvas>
                    <p style="text-align: center; color: var(--text-gray); margin-top: 15px; font-size: 14px;">
                        التغييرات تظهر مباشرة على الرسم البياني
                    </p>
                </div>
            </div>

            <div class="form-actions" style="margin-top: 25px;">
                <button type="button" class="btn btn-secondary" onclick="closeWheelModal()">إلغاء</button>
                <button type="button" class="btn btn-primary" onclick="saveWheelData()">💾 حفظ التغييرات</button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">➕ إضافة مشروع جديد</div>
            <form id="projectForm">
                <div class="form-group">
                    <label class="form-label">اسم المشروع</label>
                    <input type="text" class="form-input" id="projectName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">الوصف</label>
                    <input type="text" class="form-input" id="projectDesc" required>
                </div>
                <div class="form-group">
                    <label class="form-label">الفئة</label>
                    <input type="text" class="form-input" id="projectCategory" required>
                </div>
                <div class="form-group">
                    <label class="form-label">الحالة</label>
                    <select class="form-input" id="projectStatus">
                        <option value="progress">قيد التنفيذ</option>
                        <option value="planning">التخطيط</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">نسبة الإنجاز (%)</label>
                    <input type="number" class="form-input" id="projectProgress" min="0" max="100" value="0">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProjectModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">➕ إضافة</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Health Details Modal -->
    <div class="modal" id="healthModal">
        <div class="modal-content health-modal">
            <div class="modal-header">💚 تفاصيل مؤشر الصحة</div>
            
            <div class="health-grid">
                <!-- Water Intake -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon icon-blue">💧</div>
                        <div class="health-metric-info">
                            <h3>شرب الماء</h3>
                            <p>الهدف اليومي: 4 لتر</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number">
                            <span id="waterValue">2.6</span>
                            <span class="health-value-unit">/ 4 لتر</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 لتر</span>
                            <span>6 لتر</span>
                        </div>
                        <input type="range" class="health-slider" id="waterSlider" 
                               min="0" max="60" step="1" value="26" 
                               oninput="updateWaterValue(this.value)">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill progress-good" id="waterProgress" style="width: 65%"></div>
                        </div>
                        <div class="health-progress-text" id="waterProgressText">65% من الهدف</div>
                    </div>
                </div>

                <!-- Workout -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon" style="background: #fed7aa; color: #ea580c;">🏋️</div>
                        <div class="health-metric-info">
                            <h3>التمارين الرياضية</h3>
                            <p>الهدف اليومي: 60 دقيقة</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: #ea580c;">
                            <span id="workoutValue">62</span>
                            <span class="health-value-unit">دقيقة</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 دقيقة</span>
                            <span>120 دقيقة</span>
                        </div>
                        <input type="range" class="health-slider" id="workoutSlider" 
                               min="0" max="120" step="5" value="62" 
                               oninput="updateWorkoutValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #ea580c);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill" id="workoutProgress" 
                                 style="width: 103%; background: #ea580c;"></div>
                        </div>
                        <div class="health-progress-text" id="workoutProgressText" style="color: #ea580c;">
                            103% من الهدف ✓
                        </div>
                    </div>
                </div>

                <!-- Sleep -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon" style="background: #e0e7ff; color: #6366f1;">😴</div>
                        <div class="health-metric-info">
                            <h3>النوم</h3>
                            <p>الهدف اليومي: 8 ساعات</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: #6366f1;">
                            <span id="sleepValue">8.0</span>
                            <span class="health-value-unit">ساعة</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 ساعة</span>
                            <span>10 ساعات</span>
                        </div>
                        <input type="range" class="health-slider" id="sleepSlider" 
                               min="0" max="100" step="5" value="80" 
                               oninput="updateSleepValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #6366f1);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill" id="sleepProgress" 
                                 style="width: 100%; background: #6366f1;"></div>
                        </div>
                        <div class="health-progress-text" id="sleepProgressText" style="color: #6366f1;">
                            100% من الهدف ✓
                        </div>
                    </div>
                </div>

                <!-- Nutrition Score -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon icon-green">🥗</div>
                        <div class="health-metric-info">
                            <h3>نقاط التغذية</h3>
                            <p>الهدف اليومي: 100%</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: var(--primary-green);">
                            <span id="nutritionValue">150</span>
                            <span class="health-value-unit">%</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0%</span>
                            <span>150%</span>
                        </div>
                        <input type="range" class="health-slider" id="nutritionSlider" 
                               min="0" max="150" step="10" value="150" 
                               oninput="updateNutritionValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #10b981);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill progress-excellent" id="nutritionProgress" 
                                 style="width: 100%;"></div>
                        </div>
                        <div class="health-progress-text progress-excellent" id="nutritionProgressText">
                            150% من الهدف ✓
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Health Summary -->
            <div class="health-summary-card">
                <div class="health-summary-title">📊 الملخص الصحي اليومي</div>
                <div class="health-summary-subtitle">تتبع مقاييس العافية باستمرار للحصول على صحة مثالية</div>
                <div class="health-summary-score" id="overallHealthScore">91%</div>
                <div class="health-summary-label">النتيجة الإجمالية</div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeHealthModal()">إلغاء</button>
                <button type="button" class="btn btn-primary" onclick="saveHealthData()">💾 حفظ البيانات</button>
            </div>
        </div>
    </div>

    <!-- Goals Management Modal -->
    <div class="modal" id="goalsModal">
        <div class="modal-content goals-modal">
            <div class="modal-header">🎯 إدارة الأهداف</div>
            
            <!-- Legacy Goals Section -->
            <div class="goals-section">
                <div class="goals-section-header">
                    <div class="goals-section-title">
                        <span class="goals-section-icon">🏆</span>
                        <span>أهداف الإرث (Legacy Goals)</span>
                    </div>
                    <button class="add-goal-btn" onclick="openAddGoalModal('legacy')">
                        ➕ إضافة هدف إرث
                    </button>
                </div>
                <div class="goals-grid" id="legacyGoalsContainer"></div>
            </div>

            <!-- 2026 Objectives Section -->
            <div class="goals-section">
                <div class="goals-section-header">
                    <div class="goals-section-title">
                        <span class="goals-section-icon">📅</span>
                        <span>أهداف 2026 (2026 Objectives)</span>
                    </div>
                    <button class="add-goal-btn" onclick="openAddGoalModal('objectives2026')">
                        ➕ إضافة هدف 2026
                    </button>
                </div>
                <div class="goals-grid" id="objectives2026Container"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="closeGoalsModal()">✓ تم</button>
            </div>
        </div>
    </div>

    <!-- Goal Add/Edit Modal -->
    <div class="modal" id="goalEditModal" onclick="if(event.target === this) closeGoalEditModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header" id="goalEditModalTitle">➕ إضافة هدف جديد</div>
            <form id="goalEditForm" onsubmit="return false;">
                <input type="hidden" id="goalEditType">
                <input type="hidden" id="goalEditId">
                
                <div class="form-group">
                    <label class="form-label">عنوان الهدف</label>
                    <input type="text" class="form-input" id="goalTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">الوصف</label>
                    <textarea class="form-input" id="goalDescription" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">القيمة المستهدفة</label>
                    <input type="number" class="form-input" id="goalTargetValue" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">القيمة الحالية</label>
                    <input type="number" class="form-input" id="goalCurrentValue" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">المجال المرتبط (من عجلة الحياة)</label>
                    <select class="form-input" id="goalLinkedSector" required>
                        <option value="">اختر المجال</option>
                        <option value="Career">المهني</option>
                        <option value="Finance">المالي</option>
                        <option value="Health">الصحي</option>
                        <option value="Spirituality">الإيماني</option>
                        <option value="Social">اجتماعي</option>
                        <option value="Cultural">الثقافي</option>
                        <option value="Recreation">الترفيهي</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeGoalEditModal()">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="submitGoalForm()">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Satisfaction Management Modal -->
    <div class="modal" id="satisfactionModal">
        <div class="modal-content satisfaction-modal">
            <div class="modal-header">❤️ الرضا والإنجاز اليومي</div>
            
            <!-- Header Controls -->
            <div class="satisfaction-header">
                <div class="satisfaction-controls">
                    <input type="text" class="search-input" id="taskSearch" placeholder="🔍 البحث في المهام...">
                    <select class="filter-select" id="taskFilter">
                        <option value="all">كل المهام</option>
                        <option value="completed">المكتملة</option>
                        <option value="pending">غير المكتملة</option>
                        <option value="core">Core فقط</option>
                        <option value="bonus">Bonus فقط</option>
                    </select>
                </div>
                <div>
                    <button class="view-toggle-btn active" id="dailyViewBtn" onclick="switchView('daily')">
                        📅 اليوم
                    </button>
                    <button class="view-toggle-btn" id="weeklyViewBtn" onclick="switchView('weekly')">
                        📊 الأسبوع
                    </button>
                </div>
            </div>

            <!-- Score Card -->
            <div class="satisfaction-score-card">
                <div class="satisfaction-score-label">النتيجة الحالية</div>
                <div class="satisfaction-score-value" id="currentSatisfactionScore">40</div>
                <div class="satisfaction-score-breakdown">
                    <div class="score-breakdown-item score-core" id="coreBreakdown">
                        المهام الأساسية: 100%
                    </div>
                    <div class="score-breakdown-item score-bonus" id="bonusBreakdown">
                        المكافأة: أعلى من 100%
                    </div>
                </div>
            </div>

            <!-- Daily View -->
            <div id="dailyView">
                <div id="sectionsContainer"></div>
            </div>

            <!-- Weekly View (Hidden by default) -->
            <div id="weeklyView" style="display: none;">
                <div class="weekly-view-container">
                    <h3 style="text-align: center; margin-bottom: 20px;">📊 ملخص الأسبوع</h3>
                    <div class="weekly-chart-container">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                    <div class="weekly-average" id="weeklyAverage">
                        متوسط الأسبوع: 76%
                    </div>
                </div>
            </div>

            <!-- FAB Button -->
            <button class="add-section-fab" onclick="openAddSectionModal()" title="إضافة قسم جديد">
                ➕
            </button>

            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="closeSatisfactionModal()">✓ تم</button>
            </div>
        </div>
    </div>

    <!-- Section Add/Edit Modal -->
    <div class="modal" id="sectionEditModal">
        <div class="modal-content">
            <div class="modal-header" id="sectionEditModalTitle">➕ إضافة قسم جديد</div>
            <form id="sectionEditForm">
                <input type="hidden" id="sectionEditId">
                
                <div class="form-group">
                    <label class="form-label">اسم القسم</label>
                    <input type="text" class="form-input" id="sectionName" required placeholder="مثال: الروتين الصباحي">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSectionEditModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Add/Edit Modal -->
    <div class="modal" id="taskEditModal">
        <div class="modal-content">
            <div class="modal-header" id="taskEditModalTitle">➕ إضافة مهمة جديدة</div>
            <form id="taskEditForm">
                <input type="hidden" id="taskEditSectionId">
                <input type="hidden" id="taskEditId">
                
                <div class="form-group">
                    <label class="form-label">عنوان المهمة</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">نوع المهمة</label>
                    <select class="form-input" id="taskType" onchange="toggleBonusWeight()">
                        <option value="core">Core (أساسية)</option>
                        <option value="bonus">Bonus (إضافية)</option>
                    </select>
                </div>
                
                <div class="form-group" id="bonusWeightGroup" style="display: none;">
                    <label class="form-label">وزن المكافأة (%)</label>
                    <input type="number" class="form-input" id="taskBonusWeight" min="1" max="100" value="10">
                    <small style="color: var(--text-gray); margin-top: 5px; display: block;">
                        النسبة التي ستضاف للسكور عند إتمام هذه المهمة
                    </small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskEditModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Weekly Tracker Modal -->
    <div class="modal" id="weeklyTrackerModal">
        <div class="modal-content weekly-tracker-modal">
            <div class="modal-header">📅 متتبع الأسبوع المثالي</div>
            
            <!-- Weekly Score Header -->
            <div class="weekly-score-header">
                <div class="weekly-score-label">المتوسط الأسبوعي</div>
                <div class="weekly-score-value" id="weeklyScoreDisplay">79%</div>
            </div>

            <!-- Template Actions -->
            <div class="template-actions">
                <button class="template-btn template-weekday-btn" onclick="applyTemplateToAll('weekday')">
                    💼 تطبيق قالب أيام العمل
                </button>
                <button class="template-btn template-weekend-btn" onclick="applyTemplateToAll('weekend')">
                    🌴 تطبيق قالب نهاية الأسبوع
                </button>
            </div>

            <!-- Days Grid -->
            <div class="days-grid" id="daysGrid"></div>

            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="closeWeeklyTrackerModal()">✓ تم</button>
            </div>
        </div>
    </div>

    <!-- Day Task Add/Edit Modal -->
    <div class="modal" id="dayTaskModal">
        <div class="modal-content">
            <div class="modal-header" id="dayTaskModalTitle">➕ إضافة مهمة</div>
            <form id="dayTaskForm">
                <input type="hidden" id="dayTaskDayIndex">
                <input type="hidden" id="dayTaskId">
                
                <div class="form-group">
                    <label class="form-label">عنوان المهمة</label>
                    <input type="text" class="form-input" id="dayTaskTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">نوع المهمة</label>
                    <select class="form-input" id="dayTaskType" onchange="toggleDayBonusWeight()">
                        <option value="core">Core (أساسية)</option>
                        <option value="bonus">Bonus (إضافية)</option>
                    </select>
                </div>
                
                <div class="form-group" id="dayBonusWeightGroup" style="display: none;">
                    <label class="form-label">وزن المكافأة (%)</label>
                    <input type="number" class="form-input" id="dayTaskBonusWeight" min="1" max="100" value="10">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDayTaskModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Strategic Focus Management Modal -->
    <div class="modal" id="strategicFocusModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">🎯 إدارة التركيز الاستراتيجي</div>
            
            <div id="strategicFocusItemsContainer" style="margin-bottom: 25px;"></div>
            
            <button class="add-section-fab" onclick="openAddFocusItemModal()" 
                    style="position: relative; bottom: auto; left: auto; margin: 20px auto; display: block;">
                ➕
            </button>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="closeStrategicFocusModal()">✓ تم</button>
            </div>
        </div>
    </div>

    <!-- Focus Item Add/Edit Modal -->
    <div class="modal" id="focusItemModal">
        <div class="modal-content">
            <div class="modal-header" id="focusItemModalTitle">➕ إضافة مجال تركيز</div>
            <form id="focusItemForm">
                <input type="hidden" id="focusItemId">
                
                <div class="form-group">
                    <label class="form-label">اسم المجال</label>
                    <input type="text" class="form-input" id="focusItemName" required placeholder="مثال: التطوع">
                </div>
                
                <div class="form-group">
                    <label class="form-label">الأيقونة (اختياري)</label>
                    <select class="form-input" id="focusItemIcon">
                        <option value="">بدون أيقونة</option>
                        <option value="🎯">🎯 هدف</option>
                        <option value="💼">💼 عمل</option>
                        <option value="💰">💰 مال</option>
                        <option value="📚">📚 تعلم</option>
                        <option value="🏃">🏃 رياضة</option>
                        <option value="🤝">🤝 تطوع</option>
                        <option value="🚀">🚀 نمو</option>
                        <option value="⭐">⭐ تميز</option>
                        <option value="🎨">🎨 إبداع</option>
                        <option value="🌱">🌱 تطوير</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">اللون</label>
                    <select class="form-input" id="focusItemColor">
                        <option value="#10b981">🟢 أخضر</option>
                        <option value="#3b82f6">🔵 أزرق</option>
                        <option value="#6366f1">🟣 بنفسجي</option>
                        <option value="#f97316">🟠 برتقالي</option>
                        <option value="#ec4899">🔴 وردي</option>
                        <option value="#fbbf24">🟡 أصفر</option>
                        <option value="#8b5cf6">🟣 أرجواني</option>
                        <option value="#06b6d4">🔷 سماوي</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        نسبة التركيز: <span id="focusItemValueDisplay" style="color: var(--primary-purple); font-weight: 700;">50%</span>
                    </label>
                    <input type="range" class="form-input" id="focusItemValue" min="0" max="100" value="50" 
                           oninput="document.getElementById('focusItemValueDisplay').textContent = this.value + '%'" 
                           style="width: 100%;">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeFocusItemModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Knowledge Add Modal -->
    <div class="modal" id="knowledgeModal">
        <div class="modal-content">
            <div class="modal-header" id="knowledgeModalTitle">➕ إضافة</div>
            <form id="knowledgeForm">
                <input type="hidden" id="knowledgeType">
                <input type="hidden" id="knowledgeId">
                
                <!-- Quote Fields -->
                <div id="quoteFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">النص</label>
                        <textarea class="form-input" id="quoteText" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">المؤلف</label>
                        <input type="text" class="form-input" id="quoteAuthor">
                    </div>
                </div>
                
                <!-- Book Fields -->
                <div id="bookFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">عنوان الكتاب</label>
                        <input type="text" class="form-input" id="bookTitle">
                    </div>
                    <div class="form-group">
                        <label class="form-label">المؤلف</label>
                        <input type="text" class="form-input" id="bookAuthor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">الحالة</label>
                        <select class="form-input" id="bookStatus">
                            <option value="completed">مكتمل ✓</option>
                            <option value="reading">قيد القراءة</option>
                        </select>
                    </div>
                </div>
                
                <!-- Note Fields -->
                <div id="noteFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">العنوان</label>
                        <input type="text" class="form-input" id="noteTitle">
                    </div>
                    <div class="form-group">
                        <label class="form-label">المحتوى</label>
                        <textarea class="form-input" id="noteContent" rows="5"></textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeKnowledgeModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">💾 حفظ</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="healthModal">
        <div class="modal-content health-modal">
            <div class="modal-header">💚 تفاصيل مؤشر الصحة</div>
            
            <div class="health-grid">
                <!-- Water Intake -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon icon-blue">💧</div>
                        <div class="health-metric-info">
                            <h3>شرب الماء</h3>
                            <p>الهدف اليومي: 4 لتر</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number">
                            <span id="waterValue">2.6</span>
                            <span class="health-value-unit">/ 4 لتر</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 لتر</span>
                            <span>6 لتر</span>
                        </div>
                        <input type="range" class="health-slider" id="waterSlider" 
                               min="0" max="60" step="1" value="26" 
                               oninput="updateWaterValue(this.value)">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill progress-good" id="waterProgress" style="width: 65%"></div>
                        </div>
                        <div class="health-progress-text" id="waterProgressText">65% من الهدف</div>
                    </div>
                </div>

                <!-- Workout -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon" style="background: #fed7aa; color: #ea580c;">🏋️</div>
                        <div class="health-metric-info">
                            <h3>التمارين الرياضية</h3>
                            <p>الهدف اليومي: 60 دقيقة</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: #ea580c;">
                            <span id="workoutValue">62</span>
                            <span class="health-value-unit">دقيقة</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 دقيقة</span>
                            <span>120 دقيقة</span>
                        </div>
                        <input type="range" class="health-slider" id="workoutSlider" 
                               min="0" max="120" step="5" value="62" 
                               oninput="updateWorkoutValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #ea580c);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill" id="workoutProgress" 
                                 style="width: 103%; background: #ea580c;"></div>
                        </div>
                        <div class="health-progress-text" id="workoutProgressText" style="color: #ea580c;">
                            103% من الهدف ✓
                        </div>
                    </div>
                </div>

                <!-- Sleep -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon" style="background: #e0e7ff; color: #6366f1;">😴</div>
                        <div class="health-metric-info">
                            <h3>النوم</h3>
                            <p>الهدف اليومي: 8 ساعات</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: #6366f1;">
                            <span id="sleepValue">8.0</span>
                            <span class="health-value-unit">ساعة</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0 ساعة</span>
                            <span>10 ساعات</span>
                        </div>
                        <input type="range" class="health-slider" id="sleepSlider" 
                               min="0" max="100" step="5" value="80" 
                               oninput="updateSleepValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #6366f1);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill" id="sleepProgress" 
                                 style="width: 100%; background: #6366f1;"></div>
                        </div>
                        <div class="health-progress-text" id="sleepProgressText" style="color: #6366f1;">
                            100% من الهدف ✓
                        </div>
                    </div>
                </div>

                <!-- Nutrition Score -->
                <div class="health-metric-card">
                    <div class="health-metric-header">
                        <div class="health-metric-icon icon-green">🥗</div>
                        <div class="health-metric-info">
                            <h3>نقاط التغذية</h3>
                            <p>الهدف اليومي: 100%</p>
                        </div>
                    </div>
                    <div class="health-value-display">
                        <div class="health-value-number" style="color: var(--primary-green);">
                            <span id="nutritionValue">150</span>
                            <span class="health-value-unit">%</span>
                        </div>
                    </div>
                    <div class="health-slider-container">
                        <div class="health-slider-label">
                            <span>0%</span>
                            <span>150%</span>
                        </div>
                        <input type="range" class="health-slider" id="nutritionSlider" 
                               min="0" max="150" step="10" value="150" 
                               oninput="updateNutritionValue(this.value)"
                               style="background: linear-gradient(to left, #e2e8f0, #10b981);">
                    </div>
                    <div class="health-progress-bar-container">
                        <div class="health-progress-bar">
                            <div class="health-progress-fill progress-excellent" id="nutritionProgress" 
                                 style="width: 100%;"></div>
                        </div>
                        <div class="health-progress-text progress-excellent" id="nutritionProgressText">
                            150% من الهدف ✓
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Health Summary -->
            <div class="health-summary-card">
                <div class="health-summary-title">📊 الملخص الصحي اليومي</div>
                <div class="health-summary-subtitle">تتبع مقاييس العافية باستمرار للحصول على صحة مثالية</div>
                <div class="health-summary-score" id="overallHealthScore">91%</div>
                <div class="health-summary-label">النتيجة الإجمالية</div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeHealthModal()">إلغاء</button>
                <button type="button" class="btn btn-primary" onclick="saveHealthData()">💾 حفظ البيانات</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // Firebase Configuration & Initialization
        // ============================================
        
        let firebaseEnabled = false;
        
        // Wait for Firebase SDK to load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if Firebase is loaded
            if (typeof firebase === 'undefined') {
                console.warn('⚠️ Firebase SDK not loaded - using localStorage only');
                firebaseEnabled = false;
                return;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyATV4f1eOJIFsWcf89wj9vOSXeCZBIefmw",
                    authDomain: "saud-9b326.firebaseapp.com",
                    projectId: "saud-9b326",
                    storageBucket: "saud-9b326.firebasestorage.app",
                    messagingSenderId: "132490659875",
                    appId: "1:132490659875:web:4e7ffb4a68e182711c0996"
                };

                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                window.db = firebase.firestore();
                window.auth = firebase.auth();
                
                firebaseEnabled = true;
                console.log('🔥 Firebase initialized successfully!');
                
                // Setup auth observer
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        window.currentUser = user;
                        console.log('✅ User authenticated:', currentUser.uid);
                        
                        // If already authenticated, load data
                        if (localStorage.getItem('authenticated') === 'true') {
                            await loadData();
                        }
                    } else {
                        window.currentUser = null;
                    }
                });
            } catch (error) {
                console.warn('⚠️ Firebase initialization failed:', error);
                firebaseEnabled = false;
            }
        });
        
        // Current user (will be set by auth observer)
        let currentUser = null;
        let db = null;
        let auth = null;

        // ============================================
        // نظام الحماية بالرمز
        // ============================================
        
        // 🔑 غيّر الرمز هنا (أي رقم أو نص تبيه)
        const MASTER_PASSWORD = '12saud';
        
        // التحقق من الرمز وتسجيل الدخول عبر Firebase
        async function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('loginError');
            const loginScreen = document.getElementById('loginScreen');
            const mainContent = document.getElementById('mainContent');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (input.value === MASTER_PASSWORD) {
                // الرمز صحيح
                localStorage.setItem('authenticated', 'true');
                loginScreen.classList.add('hidden');
                mainContent.style.display = 'block';
                logoutBtn.style.display = 'block';
                error.classList.remove('show');
                
                // Try Firebase auth if available
                if (firebaseEnabled && window.auth) {
                    try {
                        const result = await window.auth.signInAnonymously();
                        window.currentUser = result.user;
                        console.log('✅ Logged in with Firebase:', currentUser.uid);
                    } catch (firebaseError) {
                        console.warn('⚠️ Firebase auth failed:', firebaseError);
                    }
                } else {
                    console.log('ℹ️ Using localStorage mode (Firebase not available)');
                }
                
                // تحميل البيانات
                await loadData();
            } else {
                // الرمز خاطئ
                error.textContent = 'الرمز غير صحيح';
                error.classList.add('show');
                input.value = '';
                input.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    input.style.animation = '';
                }, 500);
            }
        }
        
        
        // تسجيل الخروج
        async function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                if (window.auth) {
                    await window.auth.signOut();
                }
                window.currentUser = null;
                localStorage.removeItem('authenticated');
                location.reload();
            }
        }
        
        // التحقق من الدخول عند الضغط على Enter
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkPassword();
                    }
                });
            }
            
            // التحقق من حالة الدخول
            if (localStorage.getItem('authenticated') === 'true') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('logoutBtn').style.display = 'block';
                loadData();
            }
        });
        
        // إضافة تأثير الاهتزاز عند الخطأ
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
        
        // ============================================
        // باقي الكود (Data Storage)
        // ============================================
        
        // Data Storage
        let dashboardData = {
            metrics: {
                health: 78,
                goals: 44,
                satisfaction: 40,
                week: 79
            },
            healthDetails: {
                water: 2.6,      // liters (0-6)
                workout: 62,     // minutes (0-120)
                sleep: 8.0,      // hours (0-10)
                nutrition: 150   // percentage (0-150)
            },
            satisfaction: {
                sections: [
                    {
                        id: 1,
                        name: 'الروتين الصباحي',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: true },
                            { id: 2, title: 'قراءة القرآن 15 دقيقة', type: 'core', completed: true },
                            { id: 3, title: 'تمارين صباحية', type: 'core', completed: false },
                            { id: 4, title: 'قراءة 10 صفحات من كتاب', type: 'bonus', bonusWeight: 5, completed: false }
                        ]
                    },
                    {
                        id: 2,
                        name: 'عمل GOSI',
                        tasks: [
                            { id: 1, title: 'مراجعة البريد الإلكتروني', type: 'core', completed: true },
                            { id: 2, title: 'إنجاز المهام الأساسية', type: 'core', completed: true },
                            { id: 3, title: 'اجتماع الفريق', type: 'core', completed: false },
                            { id: 4, title: 'مساعدة زميل في مهمة', type: 'bonus', bonusWeight: 10, completed: false }
                        ]
                    },
                    {
                        id: 3,
                        name: 'التطوير الشخصي',
                        tasks: [
                            { id: 1, title: 'دراسة PMP ساعة', type: 'core', completed: false },
                            { id: 2, title: 'العمل على مشروع جانبي', type: 'core', completed: false },
                            { id: 3, title: 'كتابة مقال تقني', type: 'bonus', bonusWeight: 15, completed: false }
                        ]
                    }
                ],
                weeklyScores: [
                    { date: '2026-02-02', score: 85 },
                    { date: '2026-02-03', score: 90 },
                    { date: '2026-02-04', score: 75 },
                    { date: '2026-02-05', score: 95 },
                    { date: '2026-02-06', score: 80 },
                    { date: '2026-02-07', score: 70 },
                    { date: '2026-02-08', score: 40 }
                ]
            },
            weeklyTracker: {
                templates: {
                    weekday: [
                        { id: 1, title: 'صلاة الفجر في وقتها', type: 'core' },
                        { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core' },
                        { id: 3, title: 'تمارين رياضية', type: 'core' },
                        { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10 }
                    ],
                    weekend: [
                        { id: 1, title: 'صلاة الجمعة', type: 'core' },
                        { id: 2, title: 'وقت العائلة', type: 'core' },
                        { id: 3, title: 'مشروع جانبي', type: 'core' },
                        { id: 4, title: 'تطوير مهارات', type: 'bonus', bonusWeight: 15 }
                    ]
                },
                days: [
                    {
                        dayName: 'الأحد',
                        date: '2026-02-09',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: true },
                            { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: true },
                            { id: 3, title: 'تمارين رياضية', type: 'core', completed: false },
                            { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10, completed: false }
                        ]
                    },
                    {
                        dayName: 'الإثنين',
                        date: '2026-02-10',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                            { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                            { id: 3, title: 'اجتماع الفريق', type: 'core', completed: false },
                            { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10, completed: false }
                        ]
                    },
                    {
                        dayName: 'الثلاثاء',
                        date: '2026-02-11',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                            { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                            { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                        ]
                    },
                    {
                        dayName: 'الأربعاء',
                        date: '2026-02-12',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                            { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                            { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                        ]
                    },
                    {
                        dayName: 'الخميس',
                        date: '2026-02-13',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                            { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                            { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                        ]
                    },
                    {
                        dayName: 'الجمعة',
                        date: '2026-02-14',
                        tasks: [
                            { id: 1, title: 'صلاة الجمعة', type: 'core', completed: false },
                            { id: 2, title: 'وقت العائلة', type: 'core', completed: false },
                            { id: 3, title: 'مشروع جانبي', type: 'core', completed: false }
                        ]
                    },
                    {
                        dayName: 'السبت',
                        date: '2026-02-15',
                        tasks: [
                            { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                            { id: 2, title: 'وقت العائلة', type: 'core', completed: false },
                            { id: 3, title: 'مشروع جانبي', type: 'core', completed: false }
                        ]
                    }
                ]
            },
            goals: {
                legacy: [
                    {
                        id: 1,
                        title: 'أصول تدر مليون ريال سنوياً',
                        description: 'بناء محفظة استثمارية مستدامة',
                        targetValue: 1000000,
                        currentValue: 450000,
                        linkedSector: 'Finance',
                        progress: 45
                    },
                    {
                        id: 2,
                        title: 'تأسيس مشروع ريادي مستدام',
                        description: 'إطلاق شركة ناشئة في مجال التقنية',
                        targetValue: 100,
                        currentValue: 120,
                        linkedSector: 'Career',
                        progress: 120
                    }
                ],
                objectives2026: [
                    {
                        id: 1,
                        title: 'ميزانية الزواج',
                        description: 'توفير 100 ألف ريال',
                        targetValue: 100000,
                        currentValue: 65000,
                        linkedSector: 'Family',
                        progress: 65
                    },
                    {
                        id: 2,
                        title: 'قراءة 120 كتاب',
                        description: 'تطوير الذات والمعرفة',
                        targetValue: 120,
                        currentValue: 48,
                        linkedSector: 'Personal Growth',
                        progress: 40
                    },
                    {
                        id: 3,
                        title: 'شهادات PMP & CXPA',
                        description: 'الحصول على شهادتين احترافيتين',
                        targetValue: 2,
                        currentValue: 0,
                        linkedSector: 'Career',
                        progress: 0
                    }
                ]
            },
            wheelOfLife: {
                career: 75,        // المهني
                finance: 65,       // المالي
                health: 80,        // الصحي
                spirituality: 85,  // الإيماني
                social: 70,        // اجتماعي
                cultural: 78,      // الثقافي
                recreation: 60     // الترفيهي
            },
            projects: [
                {
                    name: 'تطوير منصة OGAbdullah',
                    desc: 'بناء نظام الإدارة الشامل',
                    category: 'OGAbdullah',
                    status: 'progress',
                    progress: 65
                },
                {
                    name: 'إطلاق الاستشارات الحرة',
                    desc: 'إنشاء أعمال استشارية للدخل الإضافي',
                    category: 'Side Income',
                    status: 'planning',
                    progress: 30
                }
            ],
            strategicFocus: [
                { name: 'التطوع', value: 65, color: '#10b981', icon: '🤝' },
                { name: 'الدخل الإضافي', value: 45, color: '#f97316', icon: '💰' },
                { name: 'إدارة OGAbdullah', value: 80, color: '#3b82f6', icon: '📊' },
                { name: 'مسار GOSI', value: 70, color: '#a855f7', icon: '💼' }
            ],
            routines: [
                { name: 'الصلاة والتأمل الصباحي', time: '5:00 AM', checked: false },
                { name: 'جلسة التمارين', time: '6:00 AM', checked: false },
                { name: 'كتلة العمل المركزة', time: '9:00 AM', checked: false },
                { name: 'وقت التعلم', time: '8:00 PM', checked: false }
            ],
            quotes: [
                { id: 1, text: 'الطريقة الوحيدة للقيام بعمل عظيم هي أن تحب ما تفعله', author: 'ستيف جوبز' },
                { id: 2, text: 'النجاح ليس نهائيًا، الفشل ليس قاتلاً', author: 'ونستون تشرشل' },
                { id: 3, text: 'ابدأ من حيث أنت، استخدم ما لديك، افعل ما تستطيع', author: 'آرثر آش' }
            ],
            books: [
                { id: 1, title: 'Atomic Habits', author: 'James Clear', status: 'completed' },
                { id: 2, title: 'Deep Work', author: 'Cal Newport', status: 'completed' },
                { id: 3, title: 'Thinking, Fast and Slow', author: 'Daniel Kahneman', status: 'reading' }
            ],
            booksGoal: {
                target: 120,
                current: 48
            },
            notes: [
                { id: 1, title: 'أفكار لتحسين الإنتاجية', content: 'التركيز على المهام الأساسية أولاً وتجنب المشتتات', date: '2026-02-01' },
                { id: 2, title: 'خطة التطوير المهني', content: 'الحصول على شهادة PMP والبدء في دراسة CXPA', date: '2026-02-05' }
            ],
            careerMetrics: [
                { name: 'نسبة الكفاءة', value: 142, color: '#10b981' },
                { name: 'القيمة المقدمة', value: 85, color: '#10b981' },
                { name: 'الجهد المبذول', value: 60, color: '#f97316' },
                { name: 'الإنتاج الأقصى', value: 92, color: '#a855f7' }
            ]
        };

        // Load data from localStorage
        async function loadData() {
            // Try to load from Firestore first
            if (window.currentUser && window.db) {
                try {
                    const doc = await window.db.collection('users').doc(window.currentUser.uid).get();
                    if (doc.exists) {
                        const firestoreData = doc.data().data;
                        dashboardData = {
                            ...dashboardData,
                            ...firestoreData
                        };
                        console.log('✅ Data loaded from Firestore');
                        updateUI();
                        return;
                    }
                } catch (error) {
                    console.error('❌ Error loading from Firestore:', error);
                }
            }
            
            // Fallback to localStorage
            const saved = localStorage.getItem('dashboardData');
            if (saved) {
                const parsedData = JSON.parse(saved);
                
                // Merge with default data to ensure all properties exist
                dashboardData = {
                    ...dashboardData,
                    ...parsedData
                };
                
                // Ensure weeklyTracker exists
                if (!dashboardData.weeklyTracker) {
                    dashboardData.weeklyTracker = {
                        templates: {
                            weekday: [
                                { id: 1, title: 'صلاة الفجر في وقتها', type: 'core' },
                                { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core' },
                                { id: 3, title: 'تمارين رياضية', type: 'core' },
                                { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10 }
                            ],
                            weekend: [
                                { id: 1, title: 'صلاة الجمعة', type: 'core' },
                                { id: 2, title: 'وقت العائلة', type: 'core' },
                                { id: 3, title: 'مشروع جانبي', type: 'core' },
                                { id: 4, title: 'تطوير مهارات', type: 'bonus', bonusWeight: 15 }
                            ]
                        },
                        days: [
                            {
                                dayName: 'الأحد',
                                date: '2026-02-09',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: true },
                                    { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: true },
                                    { id: 3, title: 'تمارين رياضية', type: 'core', completed: false },
                                    { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10, completed: false }
                                ]
                            },
                            {
                                dayName: 'الإثنين',
                                date: '2026-02-10',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                                    { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                                    { id: 3, title: 'اجتماع الفريق', type: 'core', completed: false },
                                    { id: 4, title: 'قراءة 10 صفحات', type: 'bonus', bonusWeight: 10, completed: false }
                                ]
                            },
                            {
                                dayName: 'الثلاثاء',
                                date: '2026-02-11',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                                    { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                                    { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                                ]
                            },
                            {
                                dayName: 'الأربعاء',
                                date: '2026-02-12',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                                    { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                                    { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                                ]
                            },
                            {
                                dayName: 'الخميس',
                                date: '2026-02-13',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                                    { id: 2, title: 'عمل GOSI 8 ساعات', type: 'core', completed: false },
                                    { id: 3, title: 'تمارين رياضية', type: 'core', completed: false }
                                ]
                            },
                            {
                                dayName: 'الجمعة',
                                date: '2026-02-14',
                                tasks: [
                                    { id: 1, title: 'صلاة الجمعة', type: 'core', completed: false },
                                    { id: 2, title: 'وقت العائلة', type: 'core', completed: false },
                                    { id: 3, title: 'مشروع جانبي', type: 'core', completed: false }
                                ]
                            },
                            {
                                dayName: 'السبت',
                                date: '2026-02-15',
                                tasks: [
                                    { id: 1, title: 'صلاة الفجر في وقتها', type: 'core', completed: false },
                                    { id: 2, title: 'وقت العائلة', type: 'core', completed: false },
                                    { id: 3, title: 'مشروع جانبي', type: 'core', completed: false }
                                ]
                            }
                        ]
                    };
                    saveData(); // Save the updated data
                }
                
                // Migrate wheelOfLife from 8 to 7 dimensions
                if (dashboardData.wheelOfLife) {
                    // If old format (8 dimensions) exists, migrate to new format (7 dimensions)
                    if (dashboardData.wheelOfLife.family || dashboardData.wheelOfLife.growth || dashboardData.wheelOfLife.environment) {
                        dashboardData.wheelOfLife = {
                            career: dashboardData.wheelOfLife.career || 75,
                            finance: dashboardData.wheelOfLife.finance || 65,
                            health: dashboardData.wheelOfLife.health || 80,
                            spirituality: dashboardData.wheelOfLife.spirituality || 85,
                            social: dashboardData.wheelOfLife.family || 70,  // family → social
                            cultural: dashboardData.wheelOfLife.growth || 78, // growth → cultural
                            recreation: dashboardData.wheelOfLife.recreation || 60
                            // environment removed
                        };
                        saveData();
                    }
                }
            }
            updateUI();
        }

        // Save data to localStorage
        async function saveData() {
            // Save to localStorage (backup)
            localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
            
            // Save to Firestore
            if (window.currentUser && window.db) {
                try {
                    await window.db.collection('users').doc(window.currentUser.uid).set({
                        data: dashboardData,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('✅ Data saved to Firestore');
                } catch (error) {
                    console.error('❌ Error saving to Firestore:', error);
                }
            }
        }

        // Update UI
        function updateUI() {
            // Calculate goals index before updating UI
            calculateGoalsIndex();
            
            // Update metrics
            document.getElementById('healthValue').textContent = dashboardData.metrics.health + '%';
            document.getElementById('goalsValue').textContent = dashboardData.metrics.goals + '%';
            document.getElementById('satisfactionValue').textContent = dashboardData.metrics.satisfaction;
            document.getElementById('weekValue').textContent = dashboardData.metrics.week + '%';
            document.getElementById('goalsFill').style.width = dashboardData.metrics.goals + '%';

            // Update charts
            updateCharts();

            // Update life areas
            updateLifeAreas();

            // Update projects
            updateProjects();

            // Update strategic focus
            updateStrategicFocus();

            // Update routines
            updateRoutines();

            // Update quotes
            updateQuotes();

            // Update career metrics
            updateCareerMetrics();
        }

        // Charts
        let healthChart, goalsChart, wheelChart;

        function createCircularChart(canvasId, value, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, 100 - value],
                        backgroundColor: [color, '#e2e8f0'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '75%',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }

        function updateCharts() {
            if (healthChart) healthChart.destroy();
            if (goalsChart) goalsChart.destroy();
            if (wheelChart) wheelChart.destroy();

            healthChart = createCircularChart('healthChart', dashboardData.metrics.health, '#10b981');
            goalsChart = createCircularChart('goalsChart', dashboardData.metrics.goals, '#6366f1');

            // Enhanced Wheel Chart with 7 Dimensions and Color Mapping
            const ctx = document.getElementById('wheelChart').getContext('2d');
            const wheelData = Object.values(dashboardData.wheelOfLife);
            const wheelLabels = ['المهني', 'المالي', 'الصحي', 'الإيماني', 'اجتماعي', 'الثقافي', 'الترفيهي'];
            const wheelColors = [
                '#6366f1', // Purple - المهني
                '#10b981', // Green - المالي
                '#f97316', // Orange - الصحي
                '#8b5cf6', // Violet - الإيماني
                '#3b82f6', // Blue - اجتماعي
                '#ec4899', // Pink - الثقافي
                '#fbbf24'  // Yellow - الترفيهي
            ];
            
            // Calculate Life Balance Score (average of 7 dimensions)
            const lifeBalanceScore = Math.round(wheelData.reduce((sum, val) => sum + val, 0) / 7);
            
            wheelChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: wheelLabels,
                    datasets: [{
                        data: wheelData,
                        backgroundColor: wheelColors,
                        borderColor: '#ffffff',
                        borderWidth: 3,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12,
                            titleFont: { size: 14, family: 'Cairo', weight: 'bold' },
                            bodyFont: { size: 13, family: 'Cairo' },
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });

        }

        function updateLifeAreas() {
            renderDimensionProgressBars();
        }

        function renderDimensionProgressBars() {
            const container = document.getElementById('dimensionAssessments');
            if (!container) return;
            
            const dimensions = [
                { key: 'career', name: 'المهني', value: dashboardData.wheelOfLife.career, color: '#6366f1' },
                { key: 'finance', name: 'المالي', value: dashboardData.wheelOfLife.finance, color: '#10b981' },
                { key: 'health', name: 'الصحي', value: dashboardData.wheelOfLife.health, color: '#f97316' },
                { key: 'spirituality', name: 'الإيماني', value: dashboardData.wheelOfLife.spirituality, color: '#8b5cf6' },
                { key: 'social', name: 'اجتماعي', value: dashboardData.wheelOfLife.social, color: '#3b82f6' },
                { key: 'cultural', name: 'الثقافي', value: dashboardData.wheelOfLife.cultural, color: '#ec4899' },
                { key: 'recreation', name: 'الترفيهي', value: dashboardData.wheelOfLife.recreation, color: '#fbbf24' }
            ];
            
            container.innerHTML = dimensions.map(dim => `
                <div class="dimension-progress-row">
                    <div class="dimension-row-label">
                        <div class="dimension-row-dot" style="background: ${dim.color};"></div>
                        <span class="dimension-row-name">${dim.name}</span>
                    </div>
                    <div class="dimension-row-bar-container">
                        <div class="dimension-row-bar-fill" id="dimBar_${dim.key}" style="width: ${dim.value}%; background: ${dim.color};"></div>
                    </div>
                    <div class="dimension-row-value" id="dimVal_${dim.key}" style="color: ${dim.color};">${dim.value}%</div>
                </div>
            `).join('');
            
            updateHeroScore();
        }

        function renderDimensionAssessments() {
            renderDimensionProgressBars();
        }

        function updateDimensionRealtime(key) {
            // This function is no longer used in this design
        }

        function updateHeroScore() {
            const values = Object.values(dashboardData.wheelOfLife);
            const lifeBalanceScore = Math.round(values.reduce((sum, val) => sum + val, 0) / 7);
            const heroEl = document.getElementById('heroLifeBalance');
            if (heroEl) {
                heroEl.textContent = lifeBalanceScore + '%';
            }
        }

        function checkGrowthPotential() {
            // Not needed in this simple design
        }

        function renderWheelLegend() {
            renderDimensionProgressBars();
        }

        function updateLifeBalanceDisplay() {
            updateHeroScore();
        }

        // Projects Filter State
        let projectsSearchTerm = '';
        let activeProjectFilters = ['all']; // Start with "all" selected

        function updateProjects() {
            const container = document.getElementById('projectsList');
            
            // Filter projects based on search and categories
            const filteredProjects = dashboardData.projects.filter(project => {
                // Search filter
                const matchesSearch = !projectsSearchTerm || 
                    project.name.toLowerCase().includes(projectsSearchTerm.toLowerCase()) ||
                    project.desc.toLowerCase().includes(projectsSearchTerm.toLowerCase());
                
                // Category filter
                const matchesCategory = activeProjectFilters.includes('all') || 
                    activeProjectFilters.includes(project.category);
                
                return matchesSearch && matchesCategory;
            });
            
            // Update chip states
            updateFilterChips();
            
            // Show empty state if no results
            if (filteredProjects.length === 0) {
                container.innerHTML = `
                    <div class="projects-empty-state">
                        <div class="projects-empty-icon">📭</div>
                        <div class="projects-empty-title">لا توجد مشاريع مطابقة</div>
                        <div class="projects-empty-text">
                            ${projectsSearchTerm ? 'جرب البحث بكلمات مختلفة' : 'لم نجد مشاريع في هذه الفئة'}
                        </div>
                        ${projectsSearchTerm || !activeProjectFilters.includes('all') ? 
                            '<button class="clear-filters-btn" onclick="clearProjectFilters()">مسح الفلاتر</button>' : 
                            '<button class="clear-filters-btn" onclick="openProjectModal()">➕ إضافة مشروع جديد</button>'}
                    </div>
                `;
                return;
            }
            
            // Render filtered projects
            container.innerHTML = filteredProjects.map(project => `
                <div class="project-card">
                    <div class="project-header">
                        <div class="project-title">${project.name}</div>
                        <div class="project-status status-${project.status}">
                            ${project.status === 'progress' ? '⏳ قيد التنفيذ' : '📋 التخطيط'}
                        </div>
                    </div>
                    <div class="project-desc">${project.desc}</div>
                    <div class="project-meta">
                        <div class="project-tag">${project.category}</div>
                        <div class="progress-bar" style="width: 150px; height: 6px;">
                            <div class="progress-fill" style="width: ${project.progress}%"></div>
                        </div>
                        <div style="font-weight: 700; color: var(--text-dark);">${project.progress}%</div>
                    </div>
                </div>
            `).join('');
        }

        function toggleProjectFilter(category) {
            if (category === 'all') {
                activeProjectFilters = ['all'];
            } else {
                // Remove 'all' if selecting specific category
                activeProjectFilters = activeProjectFilters.filter(c => c !== 'all');
                
                // Toggle the category
                if (activeProjectFilters.includes(category)) {
                    activeProjectFilters = activeProjectFilters.filter(c => c !== category);
                    // If no filters left, set to 'all'
                    if (activeProjectFilters.length === 0) {
                        activeProjectFilters = ['all'];
                    }
                } else {
                    activeProjectFilters.push(category);
                }
            }
            
            updateProjects();
        }

        function updateFilterChips() {
            document.querySelectorAll('.filter-chip').forEach(chip => {
                const category = chip.getAttribute('data-category');
                if (activeProjectFilters.includes(category)) {
                    chip.classList.add('active');
                } else {
                    chip.classList.remove('active');
                }
            });
        }

        function clearProjectFilters() {
            projectsSearchTerm = '';
            activeProjectFilters = ['all'];
            document.getElementById('projectsSearchBar').value = '';
            updateProjects();
        }

        function initializeProjectsListeners() {
            const searchBar = document.getElementById('projectsSearchBar');
            if (searchBar && !searchBar.dataset.initialized) {
                searchBar.addEventListener('input', function(e) {
                    projectsSearchTerm = e.target.value;
                    updateProjects();
                });
                searchBar.dataset.initialized = 'true';
            }
        }

        function updateStrategicFocus() {
            const container = document.getElementById('strategicFocus');
            container.innerHTML = dashboardData.strategicFocus.map(item => `
                <div class="life-area">
                    <div class="life-area-name">${item.name}</div>
                    <div class="life-area-bar">
                        <div class="life-area-progress" style="width: ${item.value}%; background: ${item.color};"></div>
                    </div>
                    <div class="life-area-value">${item.value}%</div>
                </div>
            `).join('');
        }

        function updateRoutines() {
            const container = document.getElementById('routineList');
            container.innerHTML = dashboardData.routines.map((routine, index) => `
                <div class="routine-item" onclick="toggleRoutine(${index})">
                    <div class="routine-checkbox ${routine.checked ? 'checked' : ''}"></div>
                    <div class="routine-text">
                        <div class="routine-name" style="${routine.checked ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${routine.name}</div>
                        <div class="routine-time">${routine.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Knowledge Vault Management
        let currentKnowledgeTab = 'quotes';

        function switchKnowledgeTab(tab) {
            currentKnowledgeTab = tab;
            
            // Update tabs
            document.querySelectorAll('.knowledge-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            // Update content
            document.querySelectorAll('.knowledge-tab-content').forEach(c => {
                c.classList.remove('active');
            });
            document.getElementById(tab + 'Content').classList.add('active');
            
            // Render content
            renderKnowledgeContent();
        }

        function renderKnowledgeContent() {
            if (currentKnowledgeTab === 'quotes') {
                renderQuotes();
            } else if (currentKnowledgeTab === 'books') {
                renderBooks();
            } else if (currentKnowledgeTab === 'notes') {
                renderNotes();
            }
        }

        function renderQuotes() {
            const container = document.getElementById('quotesContent');
            
            if (!dashboardData.quotes || dashboardData.quotes.length === 0) {
                container.innerHTML = `
                    <div class="empty-knowledge-state">
                        <div class="empty-knowledge-icon">💬</div>
                        <div class="empty-knowledge-text">لا توجد اقتباسات بعد</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = dashboardData.quotes.map(quote => `
                <div class="quote-card">
                    <div class="quote-actions">
                        <button class="quote-action-btn" onclick="event.stopPropagation(); editKnowledgeItem('quotes', ${quote.id})">✏️</button>
                        <button class="quote-action-btn" onclick="event.stopPropagation(); deleteKnowledgeItem('quotes', ${quote.id})">🗑️</button>
                    </div>
                    <div class="quote-text">${quote.text}</div>
                    <div class="quote-author">— ${quote.author}</div>
                </div>
            `).join('');
        }

        function renderBooks() {
            const container = document.getElementById('booksContent');
            
            if (!dashboardData.booksGoal) {
                dashboardData.booksGoal = { target: 120, current: 48 };
            }
            
            const progress = Math.round((dashboardData.booksGoal.current / dashboardData.booksGoal.target) * 100);
            
            let html = `
                <div class="books-progress-card">
                    <div class="books-progress-title">📖 هدف القراءة 2026</div>
                    <div class="books-progress-value">${dashboardData.booksGoal.current}/${dashboardData.booksGoal.target}</div>
                    <div class="books-progress-bar">
                        <div class="books-progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                    </div>
                    <div class="books-progress-label">${progress}% مكتمل • ${dashboardData.booksGoal.target - dashboardData.booksGoal.current} كتاب متبقي</div>
                </div>
            `;
            
            if (dashboardData.books && dashboardData.books.length > 0) {
                html += dashboardData.books.map(book => `
                    <div class="book-item">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div style="flex: 1;">
                                <div class="book-title">${book.title}</div>
                                <div class="book-author">${book.author}</div>
                                <span class="book-status ${book.status}">
                                    ${book.status === 'completed' ? '✓ مكتمل' : '📖 قيد القراءة'}
                                </span>
                            </div>
                            <div class="focus-item-actions">
                                <button class="goal-action-btn goal-edit-btn" onclick="editKnowledgeItem('books', ${book.id})">✏️</button>
                                <button class="goal-action-btn goal-delete-btn" onclick="deleteKnowledgeItem('books', ${book.id})">🗑️</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            container.innerHTML = html;
        }

        function renderNotes() {
            const container = document.getElementById('notesContent');
            
            if (!dashboardData.notes || dashboardData.notes.length === 0) {
                container.innerHTML = `
                    <div class="empty-knowledge-state">
                        <div class="empty-knowledge-icon">📝</div>
                        <div class="empty-knowledge-text">لا توجد ملاحظات بعد</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = dashboardData.notes.map(note => `
                <div class="note-card">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div class="note-title">${note.title}</div>
                            <div class="note-content">${note.content}</div>
                            <div class="note-date">${note.date}</div>
                        </div>
                        <div class="focus-item-actions">
                            <button class="goal-action-btn goal-edit-btn" onclick="editKnowledgeItem('notes', ${note.id})">✏️</button>
                            <button class="goal-action-btn goal-delete-btn" onclick="deleteKnowledgeItem('notes', ${note.id})">🗑️</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openAddKnowledgeModal() {
            document.getElementById('knowledgeModalTitle').textContent = '➕ إضافة ' + 
                (currentKnowledgeTab === 'quotes' ? 'اقتباس' : 
                 currentKnowledgeTab === 'books' ? 'كتاب' : 'ملاحظة');
            
            document.getElementById('knowledgeType').value = currentKnowledgeTab;
            document.getElementById('knowledgeId').value = '';
            document.getElementById('knowledgeForm').reset();
            
            // Show relevant fields
            document.getElementById('quoteFields').style.display = currentKnowledgeTab === 'quotes' ? 'block' : 'none';
            document.getElementById('bookFields').style.display = currentKnowledgeTab === 'books' ? 'block' : 'none';
            document.getElementById('noteFields').style.display = currentKnowledgeTab === 'notes' ? 'block' : 'none';
            
            document.getElementById('knowledgeModal').classList.add('active');
        }

        function closeKnowledgeModal() {
            document.getElementById('knowledgeModal').classList.remove('active');
        }

        function editKnowledgeItem(type, id) {
            let item;
            if (type === 'quotes') {
                item = dashboardData.quotes.find(q => q.id === id);
                document.getElementById('quoteText').value = item.text;
                document.getElementById('quoteAuthor').value = item.author;
            } else if (type === 'books') {
                item = dashboardData.books.find(b => b.id === id);
                document.getElementById('bookTitle').value = item.title;
                document.getElementById('bookAuthor').value = item.author;
                document.getElementById('bookStatus').value = item.status;
            } else if (type === 'notes') {
                item = dashboardData.notes.find(n => n.id === id);
                document.getElementById('noteTitle').value = item.title;
                document.getElementById('noteContent').value = item.content;
            }
            
            document.getElementById('knowledgeModalTitle').textContent = '✏️ تعديل';
            document.getElementById('knowledgeType').value = type;
            document.getElementById('knowledgeId').value = id;
            
            document.getElementById('quoteFields').style.display = type === 'quotes' ? 'block' : 'none';
            document.getElementById('bookFields').style.display = type === 'books' ? 'block' : 'none';
            document.getElementById('noteFields').style.display = type === 'notes' ? 'block' : 'none';
            
            document.getElementById('knowledgeModal').classList.add('active');
        }

        function deleteKnowledgeItem(type, id) {
            if (!confirm('هل أنت متأكد من الحذف؟')) return;
            
            if (type === 'quotes') {
                dashboardData.quotes = dashboardData.quotes.filter(q => q.id !== id);
            } else if (type === 'books') {
                dashboardData.books = dashboardData.books.filter(b => b.id !== id);
                // Update books goal current count
                const completedBooks = dashboardData.books.filter(b => b.status === 'completed').length;
                dashboardData.booksGoal.current = completedBooks;
            } else if (type === 'notes') {
                dashboardData.notes = dashboardData.notes.filter(n => n.id !== id);
            }
            
            saveData();
            renderKnowledgeContent();
        }

        function initializeKnowledgeListeners() {
            const knowledgeFormEl = document.getElementById('knowledgeForm');
            if (knowledgeFormEl && !knowledgeFormEl.dataset.initialized) {
                knowledgeFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const type = document.getElementById('knowledgeType').value;
                    const id = document.getElementById('knowledgeId').value;
                    
                    let itemData;
                    let dataArray;
                    
                    if (type === 'quotes') {
                        itemData = {
                            text: document.getElementById('quoteText').value,
                            author: document.getElementById('quoteAuthor').value
                        };
                        dataArray = dashboardData.quotes;
                    } else if (type === 'books') {
                        itemData = {
                            title: document.getElementById('bookTitle').value,
                            author: document.getElementById('bookAuthor').value,
                            status: document.getElementById('bookStatus').value
                        };
                        dataArray = dashboardData.books;
                    } else if (type === 'notes') {
                        itemData = {
                            title: document.getElementById('noteTitle').value,
                            content: document.getElementById('noteContent').value,
                            date: new Date().toISOString().split('T')[0]
                        };
                        dataArray = dashboardData.notes;
                    }
                    
                    if (id) {
                        // Edit
                        const item = dataArray.find(i => i.id === parseInt(id));
                        Object.assign(item, itemData);
                    } else {
                        // Add
                        const newId = dataArray.length > 0 ? Math.max(...dataArray.map(i => i.id)) + 1 : 1;
                        dataArray.push({ id: newId, ...itemData });
                    }
                    
                    // Update books goal if book was added/completed
                    if (type === 'books') {
                        const completedBooks = dashboardData.books.filter(b => b.status === 'completed').length;
                        dashboardData.booksGoal.current = completedBooks;
                    }
                    
                    saveData();
                    renderKnowledgeContent();
                    closeKnowledgeModal();
                });
                knowledgeFormEl.dataset.initialized = 'true';
            }
        }

        // Initialize on load
        function initializeKnowledgeVault() {
            renderKnowledgeContent();
        }

        function updateQuotes() {
            // Deprecated - now handled by renderKnowledgeContent
            initializeKnowledgeVault();
        }

        function updateCareerMetrics() {
            const container = document.getElementById('careerMetrics');
            container.innerHTML = dashboardData.careerMetrics.map(metric => `
                <div class="life-area">
                    <div class="life-area-name">${metric.name}</div>
                    <div class="life-area-bar">
                        <div class="life-area-progress" style="width: ${Math.min(metric.value, 100)}%; background: ${metric.color};"></div>
                    </div>
                    <div class="life-area-value">${metric.value}%</div>
                </div>
            `).join('');
        }

        // Toggle routine
        function toggleRoutine(index) {
            dashboardData.routines[index].checked = !dashboardData.routines[index].checked;
            saveData();
            updateRoutines();
        }

        // Modal functions
        function openEditModal() {
            document.getElementById('healthInput').value = dashboardData.metrics.health;
            document.getElementById('goalsInput').value = dashboardData.metrics.goals;
            document.getElementById('satisfactionInput').value = dashboardData.metrics.satisfaction;
            document.getElementById('weekInput').value = dashboardData.metrics.week;
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        let wheelPreviewChart = null;

        function openWheelModal() {
            // Load current values (7 dimensions)
            document.getElementById('careerInput').value = dashboardData.wheelOfLife.career;
            document.getElementById('financeInput').value = dashboardData.wheelOfLife.finance;
            document.getElementById('healthWheelInput').value = dashboardData.wheelOfLife.health;
            document.getElementById('spiritualityInput').value = dashboardData.wheelOfLife.spirituality;
            document.getElementById('socialInput').value = dashboardData.wheelOfLife.social;
            document.getElementById('culturalInput').value = dashboardData.wheelOfLife.cultural;
            document.getElementById('recreationInput').value = dashboardData.wheelOfLife.recreation;
            
            // Update displays
            updateWheelDisplays();
            
            // Initialize preview chart
            initializeWheelPreview();
            
            document.getElementById('wheelModal').classList.add('active');
        }

        function closeWheelModal() {
            document.getElementById('wheelModal').classList.remove('active');
            if (wheelPreviewChart) {
                wheelPreviewChart.destroy();
                wheelPreviewChart = null;
            }
        }

        function updateWheelDisplays() {
            document.getElementById('careerDisplay').textContent = document.getElementById('careerInput').value + '%';
            document.getElementById('financeDisplay').textContent = document.getElementById('financeInput').value + '%';
            document.getElementById('healthWheelDisplay').textContent = document.getElementById('healthWheelInput').value + '%';
            document.getElementById('spiritualityDisplay').textContent = document.getElementById('spiritualityInput').value + '%';
            document.getElementById('socialDisplay').textContent = document.getElementById('socialInput').value + '%';
            document.getElementById('culturalDisplay').textContent = document.getElementById('culturalInput').value + '%';
            document.getElementById('recreationDisplay').textContent = document.getElementById('recreationInput').value + '%';
            
            // Update Life Balance Score
            const values = [
                parseInt(document.getElementById('careerInput').value),
                parseInt(document.getElementById('financeInput').value),
                parseInt(document.getElementById('healthWheelInput').value),
                parseInt(document.getElementById('spiritualityInput').value),
                parseInt(document.getElementById('socialInput').value),
                parseInt(document.getElementById('culturalInput').value),
                parseInt(document.getElementById('recreationInput').value)
            ];
            const lifeBalanceScore = Math.round(values.reduce((sum, val) => sum + val, 0) / 7);
            document.getElementById('lifeBalanceScoreDisplay').textContent = lifeBalanceScore + '%';
        }

        function initializeWheelPreview() {
            const ctx = document.getElementById('wheelPreviewChart').getContext('2d');
            
            if (wheelPreviewChart) {
                wheelPreviewChart.destroy();
            }
            
            const wheelColors = ['#6366f1', '#10b981', '#f97316', '#8b5cf6', '#3b82f6', '#ec4899', '#fbbf24'];
            const values = [
                parseInt(document.getElementById('careerInput').value),
                parseInt(document.getElementById('financeInput').value),
                parseInt(document.getElementById('healthWheelInput').value),
                parseInt(document.getElementById('spiritualityInput').value),
                parseInt(document.getElementById('socialInput').value),
                parseInt(document.getElementById('culturalInput').value),
                parseInt(document.getElementById('recreationInput').value)
            ];
            
            wheelPreviewChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['المهني', 'المالي', 'الصحي', 'الإيماني', 'اجتماعي', 'الثقافي', 'الترفيهي'],
                    datasets: [{
                        label: 'التقييم الحالي',
                        data: values,
                        backgroundColor: wheelColors.map(c => c + '40'),
                        borderColor: wheelColors,
                        borderWidth: 3,
                        pointBackgroundColor: wheelColors,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 20,
                                font: { family: 'Cairo', size: 11 },
                                color: '#64748b'
                            },
                            pointLabels: {
                                font: { family: 'Cairo', size: 13, weight: '600' },
                                color: '#1e293b'
                            },
                            grid: {
                                color: '#e2e8f0'
                            },
                            angleLines: {
                                color: '#cbd5e1'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12,
                            titleFont: { size: 14, family: 'Cairo' },
                            bodyFont: { size: 13, family: 'Cairo' },
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.r + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateWheelPreview() {
            updateWheelDisplays();
            
            if (wheelPreviewChart) {
                wheelPreviewChart.data.datasets[0].data = [
                    parseInt(document.getElementById('careerInput').value),
                    parseInt(document.getElementById('financeInput').value),
                    parseInt(document.getElementById('healthWheelInput').value),
                    parseInt(document.getElementById('spiritualityInput').value),
                    parseInt(document.getElementById('socialInput').value),
                    parseInt(document.getElementById('culturalInput').value),
                    parseInt(document.getElementById('recreationInput').value)
                ];
                wheelPreviewChart.update('none'); // Update without animation for smooth real-time
            }
        }

        function saveWheelData() {
            dashboardData.wheelOfLife.career = parseInt(document.getElementById('careerInput').value);
            dashboardData.wheelOfLife.finance = parseInt(document.getElementById('financeInput').value);
            dashboardData.wheelOfLife.health = parseInt(document.getElementById('healthWheelInput').value);
            dashboardData.wheelOfLife.spirituality = parseInt(document.getElementById('spiritualityInput').value);
            dashboardData.wheelOfLife.social = parseInt(document.getElementById('socialInput').value);
            dashboardData.wheelOfLife.cultural = parseInt(document.getElementById('culturalInput').value);
            dashboardData.wheelOfLife.recreation = parseInt(document.getElementById('recreationInput').value);
            
            saveData();
            updateCharts(); // This will update the main wheel chart
            updateLifeAreas();
            closeWheelModal();
        }

        // Strategic Focus Management Functions
        function openStrategicFocusModal() {
            renderStrategicFocusItems();
            document.getElementById('strategicFocusModal').classList.add('active');
        }

        function closeStrategicFocusModal() {
            document.getElementById('strategicFocusModal').classList.remove('active');
        }

        function renderStrategicFocusItems() {
            const container = document.getElementById('strategicFocusItemsContainer');
            
            if (!dashboardData.strategicFocus || dashboardData.strategicFocus.length === 0) {
                container.innerHTML = `
                    <div class="projects-empty-state">
                        <div class="projects-empty-icon">🎯</div>
                        <div class="projects-empty-title">لا توجد مجالات تركيز</div>
                        <div class="projects-empty-text">أضف مجالات تركيزك الاستراتيجية</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = dashboardData.strategicFocus.map((item, index) => `
                <div class="focus-item-card">
                    <div class="focus-item-header">
                        <div class="focus-item-title">
                            ${item.icon ? `<span class="focus-item-icon">${item.icon}</span>` : ''}
                            <span>${item.name}</span>
                        </div>
                        <div class="focus-item-actions">
                            <button class="goal-action-btn goal-edit-btn" onclick="editFocusItem(${index})" title="تعديل">
                                ✏️
                            </button>
                            <button class="goal-action-btn goal-delete-btn" onclick="deleteFocusItem(${index})" title="حذف">
                                🗑️
                            </button>
                        </div>
                    </div>
                    
                    <div class="focus-item-slider-container">
                        <div class="focus-item-value-display" style="color: ${item.color};">
                            ${item.value}%
                        </div>
                        <input type="range" class="form-input" min="0" max="100" value="${item.value}" 
                               oninput="updateFocusItemValue(${index}, this.value)" 
                               style="width: 100%;">
                        <div class="focus-item-progress">
                            <div class="focus-item-progress-fill" id="focusProgress${index}" 
                                 style="width: ${item.value}%; background: ${item.color};"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateFocusItemValue(index, value) {
            dashboardData.strategicFocus[index].value = parseInt(value);
            
            // Update displays
            const cards = document.querySelectorAll('.focus-item-card');
            if (cards[index]) {
                const valueDisplay = cards[index].querySelector('.focus-item-value-display');
                const progressFill = cards[index].querySelector('.focus-item-progress-fill');
                
                if (valueDisplay) valueDisplay.textContent = value + '%';
                if (progressFill) progressFill.style.width = value + '%';
            }
            
            saveData();
            updateStrategicFocus();
        }

        function openAddFocusItemModal() {
            document.getElementById('focusItemModalTitle').textContent = '➕ إضافة مجال تركيز';
            document.getElementById('focusItemId').value = '';
            document.getElementById('focusItemForm').reset();
            document.getElementById('focusItemValueDisplay').textContent = '50%';
            document.getElementById('focusItemModal').classList.add('active');
        }

        function closeFocusItemModal() {
            document.getElementById('focusItemModal').classList.remove('active');
        }

        function editFocusItem(index) {
            const item = dashboardData.strategicFocus[index];
            
            document.getElementById('focusItemModalTitle').textContent = '✏️ تعديل مجال التركيز';
            document.getElementById('focusItemId').value = index;
            document.getElementById('focusItemName').value = item.name;
            document.getElementById('focusItemIcon').value = item.icon || '';
            document.getElementById('focusItemColor').value = item.color;
            document.getElementById('focusItemValue').value = item.value;
            document.getElementById('focusItemValueDisplay').textContent = item.value + '%';
            
            document.getElementById('focusItemModal').classList.add('active');
        }

        function deleteFocusItem(index) {
            if (!confirm('هل أنت متأكد من حذف هذا المجال؟')) return;
            
            dashboardData.strategicFocus.splice(index, 1);
            saveData();
            renderStrategicFocusItems();
            updateStrategicFocus();
        }

        // Initialize Strategic Focus form listener
        function initializeStrategicFocusListeners() {
            const focusItemFormEl = document.getElementById('focusItemForm');
            if (focusItemFormEl && !focusItemFormEl.dataset.initialized) {
                focusItemFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const index = document.getElementById('focusItemId').value;
                    const itemData = {
                        name: document.getElementById('focusItemName').value,
                        icon: document.getElementById('focusItemIcon').value,
                        color: document.getElementById('focusItemColor').value,
                        value: parseInt(document.getElementById('focusItemValue').value)
                    };
                    
                    if (index !== '') {
                        // Edit existing item
                        dashboardData.strategicFocus[parseInt(index)] = itemData;
                    } else {
                        // Add new item
                        if (!dashboardData.strategicFocus) {
                            dashboardData.strategicFocus = [];
                        }
                        dashboardData.strategicFocus.push(itemData);
                    }
                    
                    saveData();
                    renderStrategicFocusItems();
                    updateStrategicFocus();
                    closeFocusItemModal();
                });
                focusItemFormEl.dataset.initialized = 'true';
            }
        }

        function openProjectModal() {
            document.getElementById('projectForm').reset();
            document.getElementById('projectModal').classList.add('active');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
        }

        // Health Modal Functions
        function openHealthModal() {
            // Load current health data
            document.getElementById('waterSlider').value = dashboardData.healthDetails.water * 10;
            document.getElementById('workoutSlider').value = dashboardData.healthDetails.workout;
            document.getElementById('sleepSlider').value = dashboardData.healthDetails.sleep * 10;
            document.getElementById('nutritionSlider').value = dashboardData.healthDetails.nutrition;
            
            // Update displays
            updateWaterValue(dashboardData.healthDetails.water * 10);
            updateWorkoutValue(dashboardData.healthDetails.workout);
            updateSleepValue(dashboardData.healthDetails.sleep * 10);
            updateNutritionValue(dashboardData.healthDetails.nutrition);
            
            document.getElementById('healthModal').classList.add('active');
        }

        function closeHealthModal() {
            document.getElementById('healthModal').classList.remove('active');
        }

        function updateWaterValue(value) {
            const liters = value / 10;
            document.getElementById('waterValue').textContent = liters.toFixed(1);
            
            const percentage = (liters / 4) * 100;
            const barPercentage = Math.min(percentage, 100);
            document.getElementById('waterProgress').style.width = barPercentage + '%';
            
            let progressClass = 'progress-warning';
            if (percentage >= 100) progressClass = 'progress-excellent';
            else if (percentage >= 65) progressClass = 'progress-good';
            
            document.getElementById('waterProgress').className = 'health-progress-fill ' + progressClass;
            document.getElementById('waterProgressText').textContent = Math.round(percentage) + '% من الهدف' + (percentage >= 100 ? ' ✓' : '');
            document.getElementById('waterProgressText').className = 'health-progress-text ' + progressClass;
            
            calculateOverallHealth();
        }

        function updateWorkoutValue(value) {
            document.getElementById('workoutValue').textContent = value;
            
            const percentage = (value / 60) * 100;
            const barPercentage = Math.min(percentage, 100);
            document.getElementById('workoutProgress').style.width = barPercentage + '%';
            
            document.getElementById('workoutProgressText').textContent = Math.round(percentage) + '% من الهدف' + (percentage >= 100 ? ' ✓' : '');
            
            calculateOverallHealth();
        }

        function updateSleepValue(value) {
            const hours = value / 10;
            document.getElementById('sleepValue').textContent = hours.toFixed(1);
            
            const percentage = (hours / 8) * 100;
            const barPercentage = Math.min(percentage, 100);
            document.getElementById('sleepProgress').style.width = barPercentage + '%';
            
            document.getElementById('sleepProgressText').textContent = Math.round(percentage) + '% من الهدف' + (percentage >= 100 ? ' ✓' : '');
            
            calculateOverallHealth();
        }

        function updateNutritionValue(value) {
            document.getElementById('nutritionValue').textContent = value;
            
            const percentage = value;
            const barPercentage = Math.min((percentage / 150) * 100, 100);
            document.getElementById('nutritionProgress').style.width = barPercentage + '%';
            
            let text = percentage + '% من الهدف';
            if (percentage >= 100) text += ' ✓';
            document.getElementById('nutritionProgressText').textContent = text;
            
            calculateOverallHealth();
        }

        function calculateOverallHealth() {
            const water = parseFloat(document.getElementById('waterValue').textContent);
            const workout = parseInt(document.getElementById('workoutValue').textContent);
            const sleep = parseFloat(document.getElementById('sleepValue').textContent);
            const nutrition = parseInt(document.getElementById('nutritionValue').textContent);
            
            // Calculate percentages
            const waterPercent = Math.min((water / 4) * 100, 150);
            const workoutPercent = Math.min((workout / 60) * 100, 200);
            const sleepPercent = Math.min((sleep / 8) * 100, 125);
            const nutritionPercent = Math.min(nutrition, 150);
            
            // Calculate weighted average
            const overall = (waterPercent + workoutPercent + sleepPercent + nutritionPercent) / 4;
            
            document.getElementById('overallHealthScore').textContent = Math.round(overall) + '%';
            
            return Math.round(overall);
        }

        function saveHealthData() {
            // Save the data
            dashboardData.healthDetails.water = parseFloat(document.getElementById('waterValue').textContent);
            dashboardData.healthDetails.workout = parseInt(document.getElementById('workoutValue').textContent);
            dashboardData.healthDetails.sleep = parseFloat(document.getElementById('sleepValue').textContent);
            dashboardData.healthDetails.nutrition = parseInt(document.getElementById('nutritionValue').textContent);
            
            // Update overall health metric
            dashboardData.metrics.health = calculateOverallHealth();
            
            saveData();
            updateUI();
            closeHealthModal();
        }

        // Goals Management Functions
        function openGoalsModal() {
            renderGoals();
            document.getElementById('goalsModal').classList.add('active');
        }

        function closeGoalsModal() {
            document.getElementById('goalsModal').classList.remove('active');
        }

        function renderGoals() {
            renderGoalsList('legacy', 'legacyGoalsContainer');
            renderGoalsList('objectives2026', 'objectives2026Container');
        }

        function renderGoalsList(type, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error('Container not found:', containerId);
                return;
            }
            
            const goals = dashboardData.goals[type];
            
            if (goals.length === 0) {
                container.innerHTML = `
                    <div class="empty-goals-state">
                        <div class="empty-goals-icon">🎯</div>
                        <div class="empty-goals-text">لا توجد أهداف بعد</div>
                        <button class="add-goal-btn" onclick="openAddGoalModal('${type}')">
                            ➕ إضافة أول هدف
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = goals.map(goal => {
                const progress = Math.round(goal.progress);
                const barWidth = Math.min(progress, 100);
                let progressClass = 'danger';
                
                if (progress > 100) {
                    progressClass = 'extra-mile';
                } else if (progress >= 80) {
                    progressClass = 'excellent';
                } else if (progress >= 50) {
                    progressClass = 'good';
                } else if (progress >= 25) {
                    progressClass = 'warning';
                }
                
                return `
                    <div class="goal-card" data-goal-id="${goal.id}" data-goal-type="${type}">
                        ${progress > 100 ? '<div class="goal-extra-mile-badge">🚀 Extra Mile!</div>' : ''}
                        <div class="goal-card-header">
                            <div style="flex: 1;">
                                <div class="goal-title">${goal.title}</div>
                            </div>
                            <div class="goal-actions">
                                <button class="goal-action-btn goal-edit-btn" data-action="edit" data-id="${goal.id}" data-type="${type}" title="تعديل">
                                    ✏️
                                </button>
                                <button class="goal-action-btn goal-delete-btn" data-action="delete" data-id="${goal.id}" data-type="${type}" title="حذف">
                                    🗑️
                                </button>
                            </div>
                        </div>
                        <div class="goal-description">${goal.description}</div>
                        <div class="goal-linked-sector">📍 ${translateSector(goal.linkedSector)}</div>
                        <div class="goal-values">
                            <span class="goal-current">${formatNumber(goal.currentValue)}</span>
                            <span class="goal-target">من ${formatNumber(goal.targetValue)}</span>
                        </div>
                        <div class="goal-progress-container">
                            <div class="goal-progress-bar">
                                <div class="goal-progress-fill ${progressClass}" style="width: ${barWidth}%"></div>
                            </div>
                            <div class="goal-progress-text ${progressClass}">
                                ${progress}%${progress > 100 ? ' 🔥' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function translateSector(sector) {
            const translations = {
                'Career': 'المهني',
                'Finance': 'المالي',
                'Health': 'الصحي',
                'Spirituality': 'الإيماني',
                'Social': 'اجتماعي',
                'Cultural': 'الثقافي',
                'Recreation': 'الترفيهي',
                // Old names for backward compatibility
                'Family': 'اجتماعي',
                'Personal Growth': 'الثقافي',
                'Environment': 'الصحي'
            };
            return translations[sector] || sector;
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(0) + 'K';
            }
            return num.toString();
        }

        function openAddGoalModal(type) {
            document.getElementById('goalEditModalTitle').textContent = '➕ إضافة هدف جديد';
            document.getElementById('goalEditType').value = type;
            document.getElementById('goalEditId').value = '';
            document.getElementById('goalEditForm').reset();
            document.getElementById('goalEditModal').classList.add('active');
        }

        function submitGoalForm() {
            console.log('submitGoalForm called!');
            
            // Validate form
            const title = document.getElementById('goalTitle').value;
            const description = document.getElementById('goalDescription').value;
            const targetValue = document.getElementById('goalTargetValue').value;
            const currentValue = document.getElementById('goalCurrentValue').value;
            const linkedSector = document.getElementById('goalLinkedSector').value;
            
            if (!title || !description || !targetValue || !currentValue || !linkedSector) {
                alert('الرجاء ملء جميع الحقول');
                return;
            }
            
            const type = document.getElementById('goalEditType').value;
            const id = document.getElementById('goalEditId').value;
            
            console.log('Form data:', {title, description, targetValue, currentValue, linkedSector, type, id});
            
            const goalData = {
                title: title,
                description: description,
                targetValue: parseFloat(targetValue),
                currentValue: parseFloat(currentValue),
                linkedSector: linkedSector,
                progress: Math.round((parseFloat(currentValue) / parseFloat(targetValue)) * 100)
            };
            
            console.log('Goal data object:', goalData);
            
            if (id) {
                // Edit existing goal
                const goal = dashboardData.goals[type].find(g => g.id === parseInt(id));
                if (goal) {
                    Object.assign(goal, goalData);
                    console.log('Updated goal:', goal);
                }
            } else {
                // Add new goal
                const newId = dashboardData.goals[type].length > 0 
                    ? Math.max(...dashboardData.goals[type].map(g => g.id)) + 1 
                    : 1;
                const newGoal = { id: newId, ...goalData };
                dashboardData.goals[type].push(newGoal);
                console.log('Added new goal:', newGoal);
                console.log('Current goals array:', dashboardData.goals[type]);
            }
            
            saveData();
            console.log('Data saved to localStorage');
            
            renderGoals();
            console.log('Goals re-rendered');
            
            calculateGoalsIndex();
            updateUI();
            
            closeGoalEditModal();
            console.log('Modal closed');
        }

        function closeGoalEditModal() {
            document.getElementById('goalEditModal').classList.remove('active');
        }

        function editGoal(type, id) {
            const goal = dashboardData.goals[type].find(g => g.id === id);
            if (!goal) return;
            
            document.getElementById('goalEditModalTitle').textContent = '✏️ تعديل الهدف';
            document.getElementById('goalEditType').value = type;
            document.getElementById('goalEditId').value = id;
            document.getElementById('goalTitle').value = goal.title;
            document.getElementById('goalDescription').value = goal.description;
            document.getElementById('goalTargetValue').value = goal.targetValue;
            document.getElementById('goalCurrentValue').value = goal.currentValue;
            document.getElementById('goalLinkedSector').value = goal.linkedSector;
            
            document.getElementById('goalEditModal').classList.add('active');
        }

        function deleteGoal(type, id) {
            // Convert to number
            const numId = typeof id === 'number' ? id : parseInt(id);
            
            // Delete from data
            dashboardData.goals[type] = dashboardData.goals[type].filter(g => g.id !== numId);
            
            // Save to localStorage
            localStorage.setItem('dashboardData', JSON.stringify(dashboardData));
            
            // Get container
            const containerId = type === 'legacy' ? 'legacyGoalsContainer' : 'objectives2026Container';
            const container = document.getElementById(containerId);
            
            if (container) {
                // Clear and show loading
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #94a3b8;">جاري التحديث...</div>';
                
                // Re-render after brief delay
                setTimeout(() => {
                    renderGoalsList(type, containerId);
                    calculateGoalsIndex();
                    document.getElementById('goalsValue').textContent = dashboardData.metrics.goals + '%';
                    document.getElementById('goalsFill').style.width = dashboardData.metrics.goals + '%';
                }, 100);
            }
        }

        function calculateGoalsIndex() {
            const legacyGoals = dashboardData.goals.legacy;
            const objectives2026 = dashboardData.goals.objectives2026;
            
            if (legacyGoals.length === 0 && objectives2026.length === 0) {
                dashboardData.metrics.goals = 0;
                return;
            }
            
            // Calculate averages
            const legacyAvg = legacyGoals.length > 0 
                ? legacyGoals.reduce((sum, g) => sum + g.progress, 0) / legacyGoals.length 
                : 0;
            const objectives2026Avg = objectives2026.length > 0 
                ? objectives2026.reduce((sum, g) => sum + g.progress, 0) / objectives2026.length 
                : 0;
            
            // Weighted calculation: Legacy 60%, 2026 Objectives 40%
            const legacyWeight = 0.6;
            const objectives2026Weight = 0.4;
            
            let overallGoals;
            if (legacyGoals.length > 0 && objectives2026.length > 0) {
                overallGoals = (legacyAvg * legacyWeight) + (objectives2026Avg * objectives2026Weight);
            } else if (legacyGoals.length > 0) {
                overallGoals = legacyAvg;
            } else {
                overallGoals = objectives2026Avg;
            }
            
            dashboardData.metrics.goals = Math.round(overallGoals);
        }

        // Satisfaction Management Functions
        let currentView = 'daily';
        let searchTerm = '';
        let filterType = 'all';
        let weeklyChartInstance = null;

        function openSatisfactionModal() {
            renderSatisfactionView();
            document.getElementById('satisfactionModal').classList.add('active');
        }

        function closeSatisfactionModal() {
            document.getElementById('satisfactionModal').classList.remove('active');
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('dailyViewBtn').classList.toggle('active', view === 'daily');
            document.getElementById('weeklyViewBtn').classList.toggle('active', view === 'weekly');
            document.getElementById('dailyView').style.display = view === 'daily' ? 'block' : 'none';
            document.getElementById('weeklyView').style.display = view === 'weekly' ? 'block' : 'none';
            
            if (view === 'weekly') {
                renderWeeklyView();
            }
        }

        function renderSatisfactionView() {
            calculateSatisfactionScore();
            renderSections();
        }

        function calculateSatisfactionScore() {
            const sections = dashboardData.satisfaction.sections;
            let totalCoreTasks = 0;
            let completedCoreTasks = 0;
            let totalBonusPoints = 0;
            let earnedBonusPoints = 0;

            sections.forEach(section => {
                section.tasks.forEach(task => {
                    if (task.type === 'core') {
                        totalCoreTasks++;
                        if (task.completed) completedCoreTasks++;
                    } else if (task.type === 'bonus') {
                        totalBonusPoints += task.bonusWeight || 10;
                        if (task.completed) earnedBonusPoints += task.bonusWeight || 10;
                    }
                });
            });

            const corePercentage = totalCoreTasks > 0 
                ? Math.round((completedCoreTasks / totalCoreTasks) * 100) 
                : 0;
            const bonusPercentage = earnedBonusPoints;
            const totalScore = corePercentage + bonusPercentage;

            // Update displays
            document.getElementById('currentSatisfactionScore').textContent = totalScore;
            document.getElementById('coreBreakdown').textContent = `المهام الأساسية: ${corePercentage}%`;
            document.getElementById('bonusBreakdown').textContent = `المكافأة: +${bonusPercentage}%`;
            
            // Update main dashboard
            dashboardData.metrics.satisfaction = totalScore;
            document.getElementById('satisfactionValue').textContent = totalScore;
        }

        function renderSections() {
            const container = document.getElementById('sectionsContainer');
            const sections = dashboardData.satisfaction.sections;
            
            if (sections.length === 0) {
                container.innerHTML = `
                    <div class="empty-goals-state">
                        <div class="empty-goals-icon">📝</div>
                        <div class="empty-goals-text">لا توجد أقسام بعد</div>
                        <button class="add-goal-btn" onclick="openAddSectionModal()">
                            ➕ إضافة أول قسم
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = sections.map(section => {
                const filteredTasks = filterTasks(section.tasks);
                if (filteredTasks.length === 0 && searchTerm) return '';
                
                return `
                    <div class="section-container">
                        <div class="section-header">
                            <div class="section-title">${section.name}</div>
                            <div class="section-actions">
                                <button class="section-action-btn add-task-btn" onclick="openAddTaskModal(${section.id})">
                                    ➕ مهمة
                                </button>
                                <button class="section-action-btn edit-section-btn" onclick="editSection(${section.id})">
                                    ✏️
                                </button>
                                <button class="section-action-btn delete-section-btn" onclick="deleteSection(${section.id})">
                                    🗑️
                                </button>
                            </div>
                        </div>
                        <div class="tasks-list">
                            ${filteredTasks.length > 0 ? filteredTasks.map(task => renderTaskItem(section.id, task)).join('') : '<p style="text-align: center; color: var(--text-gray);">لا توجد مهام</p>'}
                        </div>
                    </div>
                `;
            }).filter(html => html).join('');
        }

        function filterTasks(tasks) {
            return tasks.filter(task => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    task.title.toLowerCase().includes(searchTerm.toLowerCase());
                
                // Type filter
                let matchesFilter = true;
                if (filterType === 'completed') matchesFilter = task.completed;
                else if (filterType === 'pending') matchesFilter = !task.completed;
                else if (filterType === 'core') matchesFilter = task.type === 'core';
                else if (filterType === 'bonus') matchesFilter = task.type === 'bonus';
                
                return matchesSearch && matchesFilter;
            });
        }

        function renderTaskItem(sectionId, task) {
            return `
                <div class="task-item ${task.completed ? 'completed' : ''}" onclick="toggleTask(${sectionId}, ${task.id})">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                    </div>
                    <span class="task-badge ${task.type}">${task.type === 'core' ? 'Core' : `Bonus +${task.bonusWeight || 10}%`}</span>
                    <div class="task-actions">
                        <button class="task-action-icon task-edit-icon" onclick="event.stopPropagation(); editTask(${sectionId}, ${task.id})">
                            ✏️
                        </button>
                        <button class="task-action-icon task-delete-icon" onclick="event.stopPropagation(); deleteTask(${sectionId}, ${task.id})">
                            🗑️
                        </button>
                    </div>
                </div>
            `;
        }

        function toggleTask(sectionId, taskId) {
            const section = dashboardData.satisfaction.sections.find(s => s.id === sectionId);
            const task = section.tasks.find(t => t.id === taskId);
            task.completed = !task.completed;
            
            saveData();
            renderSatisfactionView();
        }

        // Section Management
        function openAddSectionModal() {
            document.getElementById('sectionEditModalTitle').textContent = '➕ إضافة قسم جديد';
            document.getElementById('sectionEditId').value = '';
            document.getElementById('sectionEditForm').reset();
            document.getElementById('sectionEditModal').classList.add('active');
        }

        function closeSectionEditModal() {
            document.getElementById('sectionEditModal').classList.remove('active');
        }

        function editSection(id) {
            const section = dashboardData.satisfaction.sections.find(s => s.id === id);
            if (!section) return;
            
            document.getElementById('sectionEditModalTitle').textContent = '✏️ تعديل القسم';
            document.getElementById('sectionEditId').value = id;
            document.getElementById('sectionName').value = section.name;
            document.getElementById('sectionEditModal').classList.add('active');
        }

        function deleteSection(id) {
            if (!confirm('هل أنت متأكد من حذف هذا القسم وكل مهامه؟')) return;
            
            dashboardData.satisfaction.sections = dashboardData.satisfaction.sections.filter(s => s.id !== id);
            saveData();
            renderSatisfactionView();
        }

        // Task Management
        function openAddTaskModal(sectionId) {
            document.getElementById('taskEditModalTitle').textContent = '➕ إضافة مهمة جديدة';
            document.getElementById('taskEditSectionId').value = sectionId;
            document.getElementById('taskEditId').value = '';
            document.getElementById('taskEditForm').reset();
            document.getElementById('bonusWeightGroup').style.display = 'none';
            document.getElementById('taskEditModal').classList.add('active');
        }

        function closeTaskEditModal() {
            document.getElementById('taskEditModal').classList.remove('active');
        }

        function toggleBonusWeight() {
            const type = document.getElementById('taskType').value;
            document.getElementById('bonusWeightGroup').style.display = type === 'bonus' ? 'block' : 'none';
        }

        function editTask(sectionId, taskId) {
            const section = dashboardData.satisfaction.sections.find(s => s.id === sectionId);
            const task = section.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('taskEditModalTitle').textContent = '✏️ تعديل المهمة';
            document.getElementById('taskEditSectionId').value = sectionId;
            document.getElementById('taskEditId').value = taskId;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskType').value = task.type;
            if (task.type === 'bonus') {
                document.getElementById('taskBonusWeight').value = task.bonusWeight || 10;
                document.getElementById('bonusWeightGroup').style.display = 'block';
            }
            document.getElementById('taskEditModal').classList.add('active');
        }

        function deleteTask(sectionId, taskId) {
            if (!confirm('هل أنت متأكد من حذف هذه المهمة؟')) return;
            
            const section = dashboardData.satisfaction.sections.find(s => s.id === sectionId);
            section.tasks = section.tasks.filter(t => t.id !== taskId);
            
            saveData();
            renderSatisfactionView();
        }

        // Weekly View
        function renderWeeklyView() {
            const weeklyScores = dashboardData.satisfaction.weeklyScores;
            const average = Math.round(weeklyScores.reduce((sum, day) => sum + day.score, 0) / weeklyScores.length);
            
            document.getElementById('weeklyAverage').textContent = `متوسط الأسبوع: ${average}%`;
            
            // Destroy previous chart if exists
            if (weeklyChartInstance) {
                weeklyChartInstance.destroy();
            }
            
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            weeklyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyScores.map(d => {
                        const date = new Date(d.date);
                        return ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'][date.getDay()];
                    }),
                    datasets: [{
                        label: 'النتيجة اليومية',
                        data: weeklyScores.map(d => d.score),
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12,
                            titleFont: { size: 14, family: 'Cairo' },
                            bodyFont: { size: 13, family: 'Cairo' },
                            callbacks: {
                                label: function(context) {
                                    return 'النتيجة: ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 150,
                            ticks: {
                                font: { family: 'Cairo' },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { color: '#e2e8f0' }
                        },
                        x: {
                            ticks: { font: { family: 'Cairo' } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // Weekly Tracker Functions
        function openWeeklyTrackerModal() {
            // Make sure weeklyTracker exists
            if (!dashboardData.weeklyTracker || !dashboardData.weeklyTracker.days) {
                console.error('Weekly tracker data not initialized');
                return;
            }
            renderWeeklyTracker();
            document.getElementById('weeklyTrackerModal').classList.add('active');
        }

        function closeWeeklyTrackerModal() {
            document.getElementById('weeklyTrackerModal').classList.remove('active');
        }

        function renderWeeklyTracker() {
            if (!dashboardData.weeklyTracker || !dashboardData.weeklyTracker.days) {
                console.error('Cannot render: weeklyTracker data missing');
                return;
            }
            calculateWeeklyScore();
            renderDaysGrid();
        }

        function calculateWeeklyScore() {
            if (!dashboardData.weeklyTracker || !dashboardData.weeklyTracker.days) return;
            
            const days = dashboardData.weeklyTracker.days;
            let totalScore = 0;

            days.forEach(day => {
                const dayScore = calculateDayScore(day.tasks);
                totalScore += dayScore;
            });

            const weeklyAverage = Math.round(totalScore / days.length);
            dashboardData.metrics.week = weeklyAverage;
            
            document.getElementById('weeklyScoreDisplay').textContent = weeklyAverage + '%';
            document.getElementById('weekValue').textContent = weeklyAverage + '%';
        }

        function calculateDayScore(tasks) {
            let totalCoreTasks = 0;
            let completedCoreTasks = 0;
            let totalBonusPoints = 0;
            let earnedBonusPoints = 0;

            tasks.forEach(task => {
                if (task.type === 'core') {
                    totalCoreTasks++;
                    if (task.completed) completedCoreTasks++;
                } else if (task.type === 'bonus') {
                    totalBonusPoints += task.bonusWeight || 10;
                    if (task.completed) earnedBonusPoints += task.bonusWeight || 10;
                }
            });

            const corePercentage = totalCoreTasks > 0 
                ? Math.round((completedCoreTasks / totalCoreTasks) * 100) 
                : 0;
            const bonusPercentage = earnedBonusPoints;
            
            return corePercentage + bonusPercentage;
        }

        function renderDaysGrid() {
            if (!dashboardData.weeklyTracker || !dashboardData.weeklyTracker.days) {
                console.error('Cannot render days grid: data missing');
                return;
            }
            
            const container = document.getElementById('daysGrid');
            if (!container) {
                console.error('daysGrid container not found');
                return;
            }
            
            const days = dashboardData.weeklyTracker.days;

            container.innerHTML = days.map((day, dayIndex) => {
                const dayScore = calculateDayScore(day.tasks);
                
                return `
                    <div class="day-card">
                        <div class="day-card-header">
                            <div class="day-name">${day.dayName}</div>
                            <div class="day-score">${dayScore}%</div>
                        </div>
                        
                        <div class="day-progress-bar">
                            <div class="day-progress-fill" style="width: ${Math.min(dayScore, 100)}%"></div>
                        </div>
                        
                        <div class="day-tasks-list">
                            ${day.tasks.length > 0 ? day.tasks.map((task, taskIndex) => renderDayTask(dayIndex, task, taskIndex)).join('') : '<p style="text-align: center; color: var(--text-gray); font-size: 14px;">لا توجد مهام</p>'}
                        </div>
                        
                        <button class="day-add-task-btn" onclick="openAddDayTaskModal(${dayIndex})">
                            ➕ إضافة مهمة
                        </button>
                    </div>
                `;
            }).join('');
        }

        function renderDayTask(dayIndex, task, taskIndex) {
            const isFirst = taskIndex === 0;
            const isLast = taskIndex === dashboardData.weeklyTracker.days[dayIndex].tasks.length - 1;
            
            return `
                <div class="day-task-item ${task.completed ? 'completed' : ''}" onclick="toggleDayTask(${dayIndex}, ${taskIndex})">
                    <div class="day-task-checkbox ${task.completed ? 'checked' : ''}"></div>
                    <div class="day-task-content">
                        <div class="day-task-title">${task.title}</div>
                        <span class="task-badge ${task.type}">${task.type === 'core' ? 'Core' : `+${task.bonusWeight || 10}%`}</span>
                    </div>
                    <div class="day-task-controls">
                        ${!isFirst ? `<button class="day-task-control-btn task-up-btn" onclick="event.stopPropagation(); moveDayTaskUp(${dayIndex}, ${taskIndex})">↑</button>` : ''}
                        ${!isLast ? `<button class="day-task-control-btn task-down-btn" onclick="event.stopPropagation(); moveDayTaskDown(${dayIndex}, ${taskIndex})">↓</button>` : ''}
                        <button class="task-action-icon task-edit-icon" onclick="event.stopPropagation(); editDayTask(${dayIndex}, ${taskIndex})">✏️</button>
                        <button class="task-action-icon task-delete-icon" onclick="event.stopPropagation(); deleteDayTask(${dayIndex}, ${taskIndex})">🗑️</button>
                    </div>
                </div>
            `;
        }

        function toggleDayTask(dayIndex, taskIndex) {
            const task = dashboardData.weeklyTracker.days[dayIndex].tasks[taskIndex];
            task.completed = !task.completed;
            saveData();
            renderWeeklyTracker();
        }

        function moveDayTaskUp(dayIndex, taskIndex) {
            if (taskIndex === 0) return;
            const tasks = dashboardData.weeklyTracker.days[dayIndex].tasks;
            [tasks[taskIndex], tasks[taskIndex - 1]] = [tasks[taskIndex - 1], tasks[taskIndex]];
            saveData();
            renderWeeklyTracker();
        }

        function moveDayTaskDown(dayIndex, taskIndex) {
            const tasks = dashboardData.weeklyTracker.days[dayIndex].tasks;
            if (taskIndex === tasks.length - 1) return;
            [tasks[taskIndex], tasks[taskIndex + 1]] = [tasks[taskIndex + 1], tasks[taskIndex]];
            saveData();
            renderWeeklyTracker();
        }

        function openAddDayTaskModal(dayIndex) {
            document.getElementById('dayTaskModalTitle').textContent = '➕ إضافة مهمة';
            document.getElementById('dayTaskDayIndex').value = dayIndex;
            document.getElementById('dayTaskId').value = '';
            document.getElementById('dayTaskForm').reset();
            document.getElementById('dayBonusWeightGroup').style.display = 'none';
            document.getElementById('dayTaskModal').classList.add('active');
        }

        function closeDayTaskModal() {
            document.getElementById('dayTaskModal').classList.remove('active');
        }

        function toggleDayBonusWeight() {
            const type = document.getElementById('dayTaskType').value;
            document.getElementById('dayBonusWeightGroup').style.display = type === 'bonus' ? 'block' : 'none';
        }

        function editDayTask(dayIndex, taskIndex) {
            const task = dashboardData.weeklyTracker.days[dayIndex].tasks[taskIndex];
            
            document.getElementById('dayTaskModalTitle').textContent = '✏️ تعديل المهمة';
            document.getElementById('dayTaskDayIndex').value = dayIndex;
            document.getElementById('dayTaskId').value = taskIndex;
            document.getElementById('dayTaskTitle').value = task.title;
            document.getElementById('dayTaskType').value = task.type;
            
            if (task.type === 'bonus') {
                document.getElementById('dayTaskBonusWeight').value = task.bonusWeight || 10;
                document.getElementById('dayBonusWeightGroup').style.display = 'block';
            }
            
            document.getElementById('dayTaskModal').classList.add('active');
        }

        function deleteDayTask(dayIndex, taskIndex) {
            if (!confirm('هل أنت متأكد من حذف هذه المهمة؟')) return;
            
            dashboardData.weeklyTracker.days[dayIndex].tasks.splice(taskIndex, 1);
            saveData();
            renderWeeklyTracker();
        }

        function applyTemplateToAll(templateType) {
            const template = dashboardData.weeklyTracker.templates[templateType];
            const message = templateType === 'weekday' 
                ? 'هل تريد تطبيق قالب أيام العمل على جميع الأيام؟'
                : 'هل تريد تطبيق قالب نهاية الأسبوع على جميع الأيام؟';
            
            if (!confirm(message)) return;
            
            dashboardData.weeklyTracker.days.forEach(day => {
                day.tasks = template.map(t => ({
                    ...t,
                    id: Math.random(),
                    completed: false
                }));
            });
            
            saveData();
            renderWeeklyTracker();
        }

        // Initialize weekly tracker when needed
        function initializeWeeklyTrackerListeners() {
            const dayTaskFormEl = document.getElementById('dayTaskForm');
            if (dayTaskFormEl && !dayTaskFormEl.dataset.initialized) {
                dayTaskFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const dayIndex = parseInt(document.getElementById('dayTaskDayIndex').value);
                    const taskId = document.getElementById('dayTaskId').value;
                    const day = dashboardData.weeklyTracker.days[dayIndex];
                    
                    const taskData = {
                        title: document.getElementById('dayTaskTitle').value,
                        type: document.getElementById('dayTaskType').value,
                        completed: false
                    };
                    
                    if (taskData.type === 'bonus') {
                        taskData.bonusWeight = parseInt(document.getElementById('dayTaskBonusWeight').value) || 10;
                    }
                    
                    if (taskId !== '') {
                        // Edit existing task
                        Object.assign(day.tasks[parseInt(taskId)], taskData);
                    } else {
                        // Add new task
                        const newId = day.tasks.length > 0 
                            ? Math.max(...day.tasks.map(t => t.id || 0)) + 1 
                            : 1;
                        day.tasks.push({ id: newId, ...taskData });
                    }
                    
                    saveData();
                    renderWeeklyTracker();
                    closeDayTaskModal();
                });
                dayTaskFormEl.dataset.initialized = 'true';
            }
        }

        // Form submissions
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            dashboardData.metrics.health = parseInt(document.getElementById('healthInput').value);
            dashboardData.metrics.goals = parseInt(document.getElementById('goalsInput').value);
            dashboardData.metrics.satisfaction = parseInt(document.getElementById('satisfactionInput').value);
            dashboardData.metrics.week = parseInt(document.getElementById('weekInput').value);
            saveData();
            updateUI();
            closeEditModal();
        });

        document.getElementById('wheelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            dashboardData.wheelOfLife.career = parseInt(document.getElementById('careerInput').value);
            dashboardData.wheelOfLife.finance = parseInt(document.getElementById('financeInput').value);
            dashboardData.wheelOfLife.health = parseInt(document.getElementById('healthWheelInput').value);
            dashboardData.wheelOfLife.spirituality = parseInt(document.getElementById('spiritualityInput').value);
            dashboardData.wheelOfLife.family = parseInt(document.getElementById('familyInput').value);
            dashboardData.wheelOfLife.growth = parseInt(document.getElementById('growthInput').value);
            dashboardData.wheelOfLife.recreation = parseInt(document.getElementById('recreationInput').value);
            dashboardData.wheelOfLife.environment = parseInt(document.getElementById('environmentInput').value);
            saveData();
            updateUI();
            closeWheelModal();
        });

        document.getElementById('projectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const newProject = {
                name: document.getElementById('projectName').value,
                desc: document.getElementById('projectDesc').value,
                category: document.getElementById('projectCategory').value,
                status: document.getElementById('projectStatus').value,
                progress: parseInt(document.getElementById('projectProgress').value)
            };
            dashboardData.projects.push(newProject);
            saveData();
            updateProjects();
            closeProjectModal();
        });

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(dashboardData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'dashboard-data.json';
            link.click();
        }

        // Initialize
        window.addEventListener('load', function() {
            loadData();
            
            // Initialize goal action buttons with event delegation
            document.addEventListener('click', function(e) {
                const btn = e.target.closest('.goal-action-btn');
                if (!btn) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                const action = btn.dataset.action;
                const type = btn.dataset.type;
                const id = parseInt(btn.dataset.id);
                
                console.log('Goal button clicked:', {action, type, id});
                
                if (action === 'edit') {
                    editGoal(type, id);
                } else if (action === 'delete') {
                    // Use setTimeout to avoid event conflicts
                    setTimeout(() => {
                        deleteGoal(type, id);
                    }, 10);
                }
            });
            
            // Initialize Satisfaction event listeners after DOM is ready
            initializeSatisfactionListeners();
        });
        
        function initializeSatisfactionListeners() {
            // Task search
            const taskSearchEl = document.getElementById('taskSearch');
            if (taskSearchEl && !taskSearchEl.dataset.initialized) {
                taskSearchEl.addEventListener('input', function(e) {
                    searchTerm = e.target.value;
                    renderSections();
                });
                taskSearchEl.dataset.initialized = 'true';
            }
            
            // Task filter
            const taskFilterEl = document.getElementById('taskFilter');
            if (taskFilterEl && !taskFilterEl.dataset.initialized) {
                taskFilterEl.addEventListener('change', function(e) {
                    filterType = e.target.value;
                    renderSections();
                });
                taskFilterEl.dataset.initialized = 'true';
            }
            
            // Section edit form
            const sectionFormEl = document.getElementById('sectionEditForm');
            if (sectionFormEl && !sectionFormEl.dataset.initialized) {
                sectionFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const id = document.getElementById('sectionEditId').value;
                    const name = document.getElementById('sectionName').value;
                    
                    if (id) {
                        const section = dashboardData.satisfaction.sections.find(s => s.id === parseInt(id));
                        section.name = name;
                    } else {
                        const newId = dashboardData.satisfaction.sections.length > 0
                            ? Math.max(...dashboardData.satisfaction.sections.map(s => s.id)) + 1
                            : 1;
                        dashboardData.satisfaction.sections.push({
                            id: newId,
                            name: name,
                            tasks: []
                        });
                    }
                    
                    saveData();
                    renderSatisfactionView();
                    closeSectionEditModal();
                });
                sectionFormEl.dataset.initialized = 'true';
            }
            
            // Task edit form  
            const taskFormEl = document.getElementById('taskEditForm');
            if (taskFormEl && !taskFormEl.dataset.initialized) {
                taskFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const sectionId = parseInt(document.getElementById('taskEditSectionId').value);
                    const taskId = document.getElementById('taskEditId').value;
                    const section = dashboardData.satisfaction.sections.find(s => s.id === sectionId);
                    
                    const taskData = {
                        title: document.getElementById('taskTitle').value,
                        type: document.getElementById('taskType').value,
                        completed: false
                    };
                    
                    if (taskData.type === 'bonus') {
                        taskData.bonusWeight = parseInt(document.getElementById('taskBonusWeight').value) || 10;
                    }
                    
                    if (taskId) {
                        const task = section.tasks.find(t => t.id === parseInt(taskId));
                        Object.assign(task, taskData);
                    } else {
                        const newId = section.tasks.length > 0
                            ? Math.max(...section.tasks.map(t => t.id)) + 1
                            : 1;
                        section.tasks.push({ id: newId, ...taskData });
                    }
                    
                    saveData();
                    renderSatisfactionView();
                    closeTaskEditModal();
                });
                taskFormEl.dataset.initialized = 'true';
            }
            
            // Initialize weekly tracker listeners too
            initializeWeeklyTrackerListeners();
            
            // Initialize projects listeners
            initializeProjectsListeners();
            
            // Initialize strategic focus listeners
            initializeStrategicFocusListeners();
            
            // Initialize knowledge vault listeners
            initializeKnowledgeListeners();
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
